import { ArrayValue } from '@coveo/bueno';
import { requiredNonEmptyString, validatePayload, } from '../../../utils/validate-payload.js';
import { makeInsightAnalyticsActionFactory, } from '../../analytics/analytics-utils.js';
import { SearchPageEvents } from '../../analytics/search-action-cause.js';
import { getCaseContextAnalyticsMetadata } from '../../case-context/case-context-state.js';
import { facetIdDefinition } from '../generic/facet-actions-validation.js';
const categoryFacetBreadcrumbPayloadDefinition = {
    categoryFacetId: facetIdDefinition,
    categoryFacetPath: new ArrayValue({
        required: true,
        each: requiredNonEmptyString,
    }),
};
const getCategoryFacetMetadata = (state, { categoryFacetId, categoryFacetPath, }) => {
    const facet = state.categoryFacetSet[categoryFacetId];
    const categoryFacetField = facet?.request.field;
    const categoryFacetTitle = `${categoryFacetField}_${categoryFacetId}`;
    return {
        categoryFacetId,
        categoryFacetPath,
        categoryFacetField,
        categoryFacetTitle,
    };
};
export const logCategoryFacetBreadcrumb = (payload) => makeInsightAnalyticsActionFactory(SearchPageEvents.breadcrumbFacet)('analytics/categoryFacet/breadcrumb', (client, state) => {
    validatePayload(payload, categoryFacetBreadcrumbPayloadDefinition);
    const metadata = {
        ...getCategoryFacetMetadata(state, payload),
        ...getCaseContextAnalyticsMetadata(state.insightCaseContext),
    };
    return client.logBreadcrumbFacet(metadata);
});
