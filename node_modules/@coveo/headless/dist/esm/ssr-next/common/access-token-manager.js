/**
 * This helper allows updating the search token at any point in the SSR workflowâ€”before or after
 * static state creation, and before or after hydration.
 */
export function createAccessTokenManager(initialToken) {
    const tokenChangeCallbacks = new Set();
    let queuedToken = null;
    let currentAccessToken = initialToken;
    return {
        /**
         * Gets the current access token.
         */
        getAccessToken() {
            return currentAccessToken;
        },
        /**
         * Sets the access token, updating both configuration and active engines.
         */
        setAccessToken(accessToken) {
            currentAccessToken = accessToken;
            if (tokenChangeCallbacks.size > 0) {
                tokenChangeCallbacks.forEach((callback) => {
                    callback(accessToken);
                });
                queuedToken = null;
            }
            else {
                queuedToken = accessToken;
            }
        },
        /**
         * Registers a callback function to be invoked when the access token changes.
         * If there's a queued token, the callback will be invoked immediately.
         */
        registerCallback(callback) {
            tokenChangeCallbacks.add(callback);
            if (queuedToken) {
                callback(queuedToken);
                queuedToken = null;
            }
        },
    };
}
