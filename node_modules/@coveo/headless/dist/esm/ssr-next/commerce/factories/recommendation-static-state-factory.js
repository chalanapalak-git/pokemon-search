import { createStaticState } from '../controller-utils.js';
import { SolutionType } from '../types/controller-constants.js';
import { filterRecommendationControllers } from '../utils/recommendation-filter.js';
import { buildFactory } from './build-factory.js';
export function fetchRecommendationStaticStateFactory(controllerDefinitions, options) {
    return async (params) => {
        const allowedRecommendationKeys = params.recommendations;
        const solutionTypeBuild = await buildFactory(controllerDefinitions, options)(SolutionType.recommendation);
        const { engine, controllers } = await solutionTypeBuild(params);
        filterRecommendationControllers(controllers, controllerDefinitions ?? {}).refresh(allowedRecommendationKeys);
        const searchActions = await Promise.all(engine.waitForRequestCompletedAction());
        const staticState = createStaticState({
            searchActions,
            controllers,
        });
        return {
            ...params,
            ...staticState,
        };
    };
}
