function isEngine(obj) {
    return 'dispatch' in obj;
}
export function waitForNextStateChange(target, options = {}) {
    return new Promise((resolve) => {
        let skipFirstCall = !isEngine(target);
        let subscriberCalls = 0;
        let unsubscribe = () => { };
        unsubscribe = target.subscribe(() => {
            if (skipFirstCall) {
                skipFirstCall = false;
                return;
            }
            if (++subscriberCalls < (options?.expectedSubscriberCalls ?? 1)) {
                return;
            }
            unsubscribe();
            resolve();
        });
        options.action?.();
    });
}
