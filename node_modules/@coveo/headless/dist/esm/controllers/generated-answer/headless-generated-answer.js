import { warnIfUsingNextAnalyticsModeForServiceFeature } from '../../app/engine.js';
import { generatedAnswerAnalyticsClient } from '../../features/generated-answer/generated-answer-analytics-actions.js';
import { buildSearchAPIGeneratedAnswer } from '../core/generated-answer/headless-searchapi-generated-answer.js';
import { buildAnswerApiGeneratedAnswer } from '../knowledge/generated-answer/headless-answerapi-generated-answer.js';
import { buildGeneratedAnswerWithFollowUps, } from '../knowledge/generated-answer/headless-generated-answer-with-follow-ups.js';
/**
 * Creates a `GeneratedAnswer` controller instance.

 * @param engine - The headless engine.
 * @param props - The configurable `GeneratedAnswer` properties.
 * @returns A `GeneratedAnswer` controller instance.
 *
 * @group Controllers
 * @category GeneratedAnswer
 */
export function buildGeneratedAnswer(engine, props = {}) {
    warnIfUsingNextAnalyticsModeForServiceFeature(engine.state.configuration.analytics.analyticsMode);
    let controller;
    if (props.agentId && props.agentId.trim() !== '') {
        controller = buildGeneratedAnswerWithFollowUps(engine, generatedAnswerAnalyticsClient, { ...props, agentId: props.agentId });
    }
    else if (props.answerConfigurationId &&
        props.answerConfigurationId.trim() !== '') {
        controller = buildAnswerApiGeneratedAnswer(engine, generatedAnswerAnalyticsClient, props);
    }
    else {
        controller = buildSearchAPIGeneratedAnswer(engine, generatedAnswerAnalyticsClient, props);
    }
    return {
        ...controller,
        get state() {
            return controller.state;
        },
    };
}
