(function (global, factory) {
    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :
    typeof define === 'function' && define.amd ? define(factory) :
    (global = typeof globalThis !== 'undefined' ? globalThis : global || self, global.coveoua = factory());
})(this, (function () { 'use strict';

    /******************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
    /* global Reflect, Promise, SuppressedError, Symbol, Iterator */

    var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };

    function __extends(d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    }

    var __assign = function() {
        __assign = Object.assign || function __assign(t) {
            for (var s, i = 1, n = arguments.length; i < n; i++) {
                s = arguments[i];
                for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];
            }
            return t;
        };
        return __assign.apply(this, arguments);
    };

    function __rest(s, e) {
        var t = {};
        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
            t[p] = s[p];
        if (s != null && typeof Object.getOwnPropertySymbols === "function")
            for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
                if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                    t[p[i]] = s[p[i]];
            }
        return t;
    }

    function __awaiter(thisArg, _arguments, P, generator) {
        function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
        return new (P || (P = Promise))(function (resolve, reject) {
            function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
            function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
            function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
            step((generator = generator.apply(thisArg, _arguments || [])).next());
        });
    }

    function __generator(thisArg, body) {
        var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === "function" ? Iterator : Object).prototype);
        return g.next = verb(0), g["throw"] = verb(1), g["return"] = verb(2), typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
        function verb(n) { return function (v) { return step([n, v]); }; }
        function step(op) {
            if (f) throw new TypeError("Generator is already executing.");
            while (g && (g = 0, op[0] && (_ = 0)), _) try {
                if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
                if (y = 0, t) op = [op[0] & 2, t.value];
                switch (op[0]) {
                    case 0: case 1: t = op; break;
                    case 4: _.label++; return { value: op[1], done: false };
                    case 5: _.label++; y = op[1]; op = [0]; continue;
                    case 7: op = _.ops.pop(); _.trys.pop(); continue;
                    default:
                        if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                        if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                        if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                        if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                        if (t[2]) _.ops.pop();
                        _.trys.pop(); continue;
                }
                op = body.call(thisArg, _);
            } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
            if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
        }
    }

    function __spreadArray(to, from, pack) {
        if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {
            if (ar || !(i in from)) {
                if (!ar) ar = Array.prototype.slice.call(from, 0, i);
                ar[i] = from[i];
            }
        }
        return to.concat(ar || Array.prototype.slice.call(from));
    }

    typeof SuppressedError === "function" ? SuppressedError : function (error, suppressed, message) {
        var e = new Error(message);
        return e.name = "SuppressedError", e.error = error, e.suppressed = suppressed, e;
    };

    var EventType;
    (function (EventType) {
        EventType["search"] = "search";
        EventType["click"] = "click";
        EventType["custom"] = "custom";
        EventType["view"] = "view";
        EventType["collect"] = "collect";
    })(EventType || (EventType = {}));

    function hasWindow() {
        return typeof window !== 'undefined';
    }
    function hasNavigator() {
        return typeof navigator !== 'undefined';
    }
    function hasDocument() {
        return typeof document !== 'undefined';
    }
    function hasLocalStorage() {
        try {
            return typeof localStorage !== 'undefined';
        }
        catch (error) {
            return false;
        }
    }
    function hasSessionStorage() {
        try {
            return typeof sessionStorage !== 'undefined';
        }
        catch (error) {
            return false;
        }
    }
    function hasCookieStorage() {
        return hasNavigator() && navigator.cookieEnabled;
    }

    var eventTypesForDefaultValues = [EventType.click, EventType.custom, EventType.search, EventType.view];
    var addDefaultValues = function (eventType, payload) {
        return eventTypesForDefaultValues.indexOf(eventType) !== -1
            ? __assign({ language: hasDocument() ? document.documentElement.lang : 'unknown', userAgent: hasNavigator() ? navigator.userAgent : 'unknown' }, payload) : payload;
    };

    var Cookie = (function () {
        function Cookie() {
        }
        Cookie.set = function (name, value, expire) {
            var domain, expirationDate, domainParts, host;
            if (expire) {
                expirationDate = new Date();
                expirationDate.setTime(expirationDate.getTime() + expire);
            }
            host = window.location.hostname;
            if (host.indexOf('.') === -1) {
                writeCookie(name, value, expirationDate);
            }
            else {
                domainParts = host.split('.');
                domain = domainParts[domainParts.length - 2] + '.' + domainParts[domainParts.length - 1];
                writeCookie(name, value, expirationDate, domain);
            }
        };
        Cookie.get = function (name) {
            var cookiePrefix = name + '=';
            var cookieArray = document.cookie.split(';');
            for (var i = 0; i < cookieArray.length; i++) {
                var cookie = cookieArray[i];
                cookie = cookie.replace(/^\s+/, '');
                if (cookie.lastIndexOf(cookiePrefix, 0) === 0) {
                    return cookie.substring(cookiePrefix.length, cookie.length);
                }
            }
            return null;
        };
        Cookie.erase = function (name) {
            Cookie.set(name, '', -1);
        };
        return Cookie;
    }());
    function writeCookie(name, value, expirationDate, domain) {
        document.cookie =
            "".concat(name, "=").concat(value) +
                (expirationDate ? ";expires=".concat(expirationDate.toUTCString()) : '') +
                (domain ? ";domain=".concat(domain) : '') +
                ';path=/;SameSite=Lax';
    }

    var preferredStorage = null;
    function getAvailableStorage() {
        if (hasLocalStorage()) {
            return localStorage;
        }
        if (hasCookieStorage()) {
            return new CookieStorage();
        }
        if (hasSessionStorage()) {
            return sessionStorage;
        }
        return new NullStorage();
    }
    var CookieStorage = (function () {
        function CookieStorage() {
        }
        CookieStorage.prototype.getItem = function (key) {
            return Cookie.get("".concat(CookieStorage.prefix).concat(key));
        };
        CookieStorage.prototype.removeItem = function (key) {
            Cookie.erase("".concat(CookieStorage.prefix).concat(key));
        };
        CookieStorage.prototype.setItem = function (key, data, expire) {
            Cookie.set("".concat(CookieStorage.prefix).concat(key), data, expire);
        };
        CookieStorage.prefix = 'coveo_';
        return CookieStorage;
    }());
    var CookieAndLocalStorage = (function () {
        function CookieAndLocalStorage() {
            this.cookieStorage = new CookieStorage();
        }
        CookieAndLocalStorage.prototype.getItem = function (key) {
            return localStorage.getItem(key) || this.cookieStorage.getItem(key);
        };
        CookieAndLocalStorage.prototype.removeItem = function (key) {
            this.cookieStorage.removeItem(key);
            localStorage.removeItem(key);
        };
        CookieAndLocalStorage.prototype.setItem = function (key, data) {
            localStorage.setItem(key, data);
            this.cookieStorage.setItem(key, data, 31556926000);
        };
        return CookieAndLocalStorage;
    }());
    var NullStorage = (function () {
        function NullStorage() {
        }
        NullStorage.prototype.getItem = function (key) {
            return null;
        };
        NullStorage.prototype.removeItem = function (key) {
        };
        NullStorage.prototype.setItem = function (key, data) {
        };
        return NullStorage;
    }());

    var storage = /*#__PURE__*/Object.freeze({
        __proto__: null,
        CookieAndLocalStorage: CookieAndLocalStorage,
        CookieStorage: CookieStorage,
        NullStorage: NullStorage,
        getAvailableStorage: getAvailableStorage,
        preferredStorage: preferredStorage
    });

    var STORE_KEY = '__coveo.analytics.history';
    var MAX_NUMBER_OF_HISTORY_ELEMENTS = 20;
    var MIN_THRESHOLD_FOR_DUPLICATE_VALUE = 1000 * 60;
    var MAX_VALUE_SIZE = 75;
    var HistoryStore = (function () {
        function HistoryStore(store) {
            this.store = store || getAvailableStorage();
        }
        HistoryStore.prototype.addElement = function (elem) {
            elem.internalTime = new Date().getTime();
            elem = this.cropQueryElement(this.stripEmptyQuery(elem));
            var currentHistory = this.getHistoryWithInternalTime();
            if (currentHistory != null) {
                if (this.isValidEntry(elem)) {
                    this.setHistory([elem].concat(currentHistory));
                }
            }
            else {
                this.setHistory([elem]);
            }
        };
        HistoryStore.prototype.addElementAsync = function (elem) {
            return __awaiter(this, void 0, void 0, function () {
                var currentHistory;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            elem.internalTime = new Date().getTime();
                            elem = this.cropQueryElement(this.stripEmptyQuery(elem));
                            return [4, this.getHistoryWithInternalTimeAsync()];
                        case 1:
                            currentHistory = _a.sent();
                            if (currentHistory != null) {
                                if (this.isValidEntry(elem)) {
                                    this.setHistory([elem].concat(currentHistory));
                                }
                            }
                            else {
                                this.setHistory([elem]);
                            }
                            return [2];
                    }
                });
            });
        };
        HistoryStore.prototype.getHistory = function () {
            var history = this.getHistoryWithInternalTime();
            return this.stripEmptyQueries(this.stripInternalTime(history));
        };
        HistoryStore.prototype.getHistoryAsync = function () {
            return __awaiter(this, void 0, void 0, function () {
                var history;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.getHistoryWithInternalTimeAsync()];
                        case 1:
                            history = _a.sent();
                            return [2, this.stripEmptyQueries(this.stripInternalTime(history))];
                    }
                });
            });
        };
        HistoryStore.prototype.getHistoryWithInternalTime = function () {
            try {
                var elements = this.store.getItem(STORE_KEY);
                if (elements && typeof elements === 'string') {
                    return JSON.parse(elements);
                }
                else {
                    return [];
                }
            }
            catch (e) {
                return [];
            }
        };
        HistoryStore.prototype.getHistoryWithInternalTimeAsync = function () {
            return __awaiter(this, void 0, void 0, function () {
                var elements;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            _a.trys.push([0, 2, , 3]);
                            return [4, this.store.getItem(STORE_KEY)];
                        case 1:
                            elements = _a.sent();
                            if (elements) {
                                return [2, JSON.parse(elements)];
                            }
                            else {
                                return [2, []];
                            }
                        case 2:
                            _a.sent();
                            return [2, []];
                        case 3: return [2];
                    }
                });
            });
        };
        HistoryStore.prototype.setHistory = function (history) {
            try {
                this.store.setItem(STORE_KEY, JSON.stringify(history.slice(0, MAX_NUMBER_OF_HISTORY_ELEMENTS)));
            }
            catch (e) {
            }
        };
        HistoryStore.prototype.clear = function () {
            try {
                this.store.removeItem(STORE_KEY);
            }
            catch (e) {
            }
        };
        HistoryStore.prototype.getMostRecentElement = function () {
            var currentHistory = this.getHistoryWithInternalTime();
            if (Array.isArray(currentHistory)) {
                var sorted = currentHistory.sort(function (first, second) {
                    return (second.internalTime || 0) - (first.internalTime || 0);
                });
                return sorted[0];
            }
            return null;
        };
        HistoryStore.prototype.cropQueryElement = function (part) {
            if (part.name && part.value && part.name.toLowerCase() === 'query') {
                part.value = part.value.slice(0, MAX_VALUE_SIZE);
            }
            return part;
        };
        HistoryStore.prototype.isValidEntry = function (elem) {
            var lastEntry = this.getMostRecentElement();
            if (lastEntry && lastEntry.value == elem.value) {
                return (elem.internalTime || 0) - (lastEntry.internalTime || 0) > MIN_THRESHOLD_FOR_DUPLICATE_VALUE;
            }
            return true;
        };
        HistoryStore.prototype.stripInternalTime = function (history) {
            if (Array.isArray(history)) {
                return history.map(function (part) {
                    var name = part.name, time = part.time, value = part.value;
                    return { name: name, time: time, value: value };
                });
            }
            return [];
        };
        HistoryStore.prototype.stripEmptyQuery = function (part) {
            var name = part.name, time = part.time, value = part.value;
            if (name && typeof value === 'string' && name.toLowerCase() === 'query' && value.trim() === '') {
                return { name: name, time: time };
            }
            return part;
        };
        HistoryStore.prototype.stripEmptyQueries = function (history) {
            var _this = this;
            return history.map(function (part) { return _this.stripEmptyQuery(part); });
        };
        return HistoryStore;
    }());

    var history = /*#__PURE__*/Object.freeze({
        __proto__: null,
        HistoryStore: HistoryStore,
        MAX_NUMBER_OF_HISTORY_ELEMENTS: MAX_NUMBER_OF_HISTORY_ELEMENTS,
        MAX_VALUE_SIZE: MAX_VALUE_SIZE,
        MIN_THRESHOLD_FOR_DUPLICATE_VALUE: MIN_THRESHOLD_FOR_DUPLICATE_VALUE,
        STORE_KEY: STORE_KEY,
        default: HistoryStore
    });

    var enhanceViewEvent = function (eventType, payload) { return __awaiter(void 0, void 0, void 0, function () {
        return __generator(this, function (_a) {
            switch (_a.label) {
                case 0:
                    if (!(eventType === EventType.view)) return [3, 2];
                    return [4, addPageViewToHistory(payload.contentIdValue)];
                case 1:
                    _a.sent();
                    return [2, __assign({ location: window.location.toString(), referrer: document.referrer, title: document.title }, payload)];
                case 2: return [2, payload];
            }
        });
    }); };
    var addPageViewToHistory = function (pageViewValue) { return __awaiter(void 0, void 0, void 0, function () {
        var store, historyElement;
        return __generator(this, function (_a) {
            switch (_a.label) {
                case 0:
                    store = new HistoryStore();
                    historyElement = {
                        name: 'PageView',
                        value: pageViewValue,
                        time: new Date().toISOString(),
                    };
                    return [4, store.addElementAsync(historyElement)];
                case 1:
                    _a.sent();
                    return [2];
            }
        });
    }); };

    // Unique ID creation requires a high quality random # generator. In the browser we therefore
    // require the crypto API and do not support built-in fallback to lower quality random number
    // generators (like Math.random()).
    let getRandomValues;
    const rnds8 = new Uint8Array(16);
    function rng() {
      // lazy load so that environments that need to polyfill have a chance to do so
      if (!getRandomValues) {
        // getRandomValues needs to be invoked in a context where "this" is a Crypto implementation.
        getRandomValues = typeof crypto !== 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto);

        if (!getRandomValues) {
          throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');
        }
      }

      return getRandomValues(rnds8);
    }

    var REGEX = /^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;

    function validate(uuid) {
      return typeof uuid === 'string' && REGEX.test(uuid);
    }

    /**
     * Convert array of 16 byte values to UUID string format of the form:
     * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX
     */

    const byteToHex = [];

    for (let i = 0; i < 256; ++i) {
      byteToHex.push((i + 0x100).toString(16).slice(1));
    }

    function unsafeStringify(arr, offset = 0) {
      // Note: Be careful editing this code!  It's been tuned for performance
      // and works in ways you may not expect. See https://github.com/uuidjs/uuid/pull/434
      return byteToHex[arr[offset + 0]] + byteToHex[arr[offset + 1]] + byteToHex[arr[offset + 2]] + byteToHex[arr[offset + 3]] + '-' + byteToHex[arr[offset + 4]] + byteToHex[arr[offset + 5]] + '-' + byteToHex[arr[offset + 6]] + byteToHex[arr[offset + 7]] + '-' + byteToHex[arr[offset + 8]] + byteToHex[arr[offset + 9]] + '-' + byteToHex[arr[offset + 10]] + byteToHex[arr[offset + 11]] + byteToHex[arr[offset + 12]] + byteToHex[arr[offset + 13]] + byteToHex[arr[offset + 14]] + byteToHex[arr[offset + 15]];
    }

    function parse(uuid) {
      if (!validate(uuid)) {
        throw TypeError('Invalid UUID');
      }

      let v;
      const arr = new Uint8Array(16); // Parse ########-....-....-....-............

      arr[0] = (v = parseInt(uuid.slice(0, 8), 16)) >>> 24;
      arr[1] = v >>> 16 & 0xff;
      arr[2] = v >>> 8 & 0xff;
      arr[3] = v & 0xff; // Parse ........-####-....-....-............

      arr[4] = (v = parseInt(uuid.slice(9, 13), 16)) >>> 8;
      arr[5] = v & 0xff; // Parse ........-....-####-....-............

      arr[6] = (v = parseInt(uuid.slice(14, 18), 16)) >>> 8;
      arr[7] = v & 0xff; // Parse ........-....-....-####-............

      arr[8] = (v = parseInt(uuid.slice(19, 23), 16)) >>> 8;
      arr[9] = v & 0xff; // Parse ........-....-....-....-############
      // (Use "/" to avoid 32-bit truncation when bit-shifting high-order bytes)

      arr[10] = (v = parseInt(uuid.slice(24, 36), 16)) / 0x10000000000 & 0xff;
      arr[11] = v / 0x100000000 & 0xff;
      arr[12] = v >>> 24 & 0xff;
      arr[13] = v >>> 16 & 0xff;
      arr[14] = v >>> 8 & 0xff;
      arr[15] = v & 0xff;
      return arr;
    }

    function stringToBytes(str) {
      str = unescape(encodeURIComponent(str)); // UTF8 escape

      const bytes = [];

      for (let i = 0; i < str.length; ++i) {
        bytes.push(str.charCodeAt(i));
      }

      return bytes;
    }

    const DNS = '6ba7b810-9dad-11d1-80b4-00c04fd430c8';
    const URL$1 = '6ba7b811-9dad-11d1-80b4-00c04fd430c8';
    function v35(name, version, hashfunc) {
      function generateUUID(value, namespace, buf, offset) {
        var _namespace;

        if (typeof value === 'string') {
          value = stringToBytes(value);
        }

        if (typeof namespace === 'string') {
          namespace = parse(namespace);
        }

        if (((_namespace = namespace) === null || _namespace === void 0 ? void 0 : _namespace.length) !== 16) {
          throw TypeError('Namespace must be array-like (16 iterable integer values, 0-255)');
        } // Compute hash of namespace and value, Per 4.3
        // Future: Use spread syntax when supported on all platforms, e.g. `bytes =
        // hashfunc([...namespace, ... value])`


        let bytes = new Uint8Array(16 + value.length);
        bytes.set(namespace);
        bytes.set(value, namespace.length);
        bytes = hashfunc(bytes);
        bytes[6] = bytes[6] & 0x0f | version;
        bytes[8] = bytes[8] & 0x3f | 0x80;

        if (buf) {
          offset = offset || 0;

          for (let i = 0; i < 16; ++i) {
            buf[offset + i] = bytes[i];
          }

          return buf;
        }

        return unsafeStringify(bytes);
      } // Function#name is not settable on some platforms (#270)


      try {
        generateUUID.name = name; // eslint-disable-next-line no-empty
      } catch (err) {} // For CommonJS default export support


      generateUUID.DNS = DNS;
      generateUUID.URL = URL$1;
      return generateUUID;
    }

    const randomUUID = typeof crypto !== 'undefined' && crypto.randomUUID && crypto.randomUUID.bind(crypto);
    var native = {
      randomUUID
    };

    function v4(options, buf, offset) {
      if (native.randomUUID && !buf && !options) {
        return native.randomUUID();
      }

      options = options || {};
      const rnds = options.random || (options.rng || rng)(); // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`

      rnds[6] = rnds[6] & 0x0f | 0x40;
      rnds[8] = rnds[8] & 0x3f | 0x80; // Copy bytes to buffer, if provided

      if (buf) {
        offset = offset || 0;

        for (let i = 0; i < 16; ++i) {
          buf[offset + i] = rnds[i];
        }

        return buf;
      }

      return unsafeStringify(rnds);
    }

    // Adapted from Chris Veness' SHA1 code at
    // http://www.movable-type.co.uk/scripts/sha1.html
    function f(s, x, y, z) {
      switch (s) {
        case 0:
          return x & y ^ ~x & z;

        case 1:
          return x ^ y ^ z;

        case 2:
          return x & y ^ x & z ^ y & z;

        case 3:
          return x ^ y ^ z;
      }
    }

    function ROTL(x, n) {
      return x << n | x >>> 32 - n;
    }

    function sha1(bytes) {
      const K = [0x5a827999, 0x6ed9eba1, 0x8f1bbcdc, 0xca62c1d6];
      const H = [0x67452301, 0xefcdab89, 0x98badcfe, 0x10325476, 0xc3d2e1f0];

      if (typeof bytes === 'string') {
        const msg = unescape(encodeURIComponent(bytes)); // UTF8 escape

        bytes = [];

        for (let i = 0; i < msg.length; ++i) {
          bytes.push(msg.charCodeAt(i));
        }
      } else if (!Array.isArray(bytes)) {
        // Convert Array-like to Array
        bytes = Array.prototype.slice.call(bytes);
      }

      bytes.push(0x80);
      const l = bytes.length / 4 + 2;
      const N = Math.ceil(l / 16);
      const M = new Array(N);

      for (let i = 0; i < N; ++i) {
        const arr = new Uint32Array(16);

        for (let j = 0; j < 16; ++j) {
          arr[j] = bytes[i * 64 + j * 4] << 24 | bytes[i * 64 + j * 4 + 1] << 16 | bytes[i * 64 + j * 4 + 2] << 8 | bytes[i * 64 + j * 4 + 3];
        }

        M[i] = arr;
      }

      M[N - 1][14] = (bytes.length - 1) * 8 / Math.pow(2, 32);
      M[N - 1][14] = Math.floor(M[N - 1][14]);
      M[N - 1][15] = (bytes.length - 1) * 8 & 0xffffffff;

      for (let i = 0; i < N; ++i) {
        const W = new Uint32Array(80);

        for (let t = 0; t < 16; ++t) {
          W[t] = M[i][t];
        }

        for (let t = 16; t < 80; ++t) {
          W[t] = ROTL(W[t - 3] ^ W[t - 8] ^ W[t - 14] ^ W[t - 16], 1);
        }

        let a = H[0];
        let b = H[1];
        let c = H[2];
        let d = H[3];
        let e = H[4];

        for (let t = 0; t < 80; ++t) {
          const s = Math.floor(t / 20);
          const T = ROTL(a, 5) + f(s, b, c, d) + e + K[s] + W[t] >>> 0;
          e = d;
          d = c;
          c = ROTL(b, 30) >>> 0;
          b = a;
          a = T;
        }

        H[0] = H[0] + a >>> 0;
        H[1] = H[1] + b >>> 0;
        H[2] = H[2] + c >>> 0;
        H[3] = H[3] + d >>> 0;
        H[4] = H[4] + e >>> 0;
      }

      return [H[0] >> 24 & 0xff, H[0] >> 16 & 0xff, H[0] >> 8 & 0xff, H[0] & 0xff, H[1] >> 24 & 0xff, H[1] >> 16 & 0xff, H[1] >> 8 & 0xff, H[1] & 0xff, H[2] >> 24 & 0xff, H[2] >> 16 & 0xff, H[2] >> 8 & 0xff, H[2] & 0xff, H[3] >> 24 & 0xff, H[3] >> 16 & 0xff, H[3] >> 8 & 0xff, H[3] & 0xff, H[4] >> 24 & 0xff, H[4] >> 16 & 0xff, H[4] >> 8 & 0xff, H[4] & 0xff];
    }

    const v5 = v35('v5', 0x50, sha1);
    var uuidv5 = v5;

    var libVersion = "2.30.52";

    var getFormattedLocation = function (location) {
        return "".concat(location.protocol, "//").concat(location.hostname).concat(location.pathname.indexOf('/') === 0 ? location.pathname : "/".concat(location.pathname)).concat(location.search);
    };

    var BasePluginEventTypes = {
        pageview: 'pageview',
        event: 'event',
    };
    var Plugin = (function () {
        function Plugin(_a) {
            var client = _a.client, _b = _a.uuidGenerator, uuidGenerator = _b === void 0 ? v4 : _b;
            this.client = client;
            this.uuidGenerator = uuidGenerator;
        }
        return Plugin;
    }());
    var BasePlugin = (function (_super) {
        __extends(BasePlugin, _super);
        function BasePlugin(_a) {
            var client = _a.client, _b = _a.uuidGenerator, uuidGenerator = _b === void 0 ? v4 : _b;
            var _this = _super.call(this, { client: client, uuidGenerator: uuidGenerator }) || this;
            _this.actionData = {};
            _this.pageViewId = uuidGenerator();
            _this.nextPageViewId = _this.pageViewId;
            _this.currentLocation = getFormattedLocation(window.location);
            _this.lastReferrer = hasDocument() ? document.referrer : '';
            _this.addHooks();
            return _this;
        }
        BasePlugin.prototype.getApi = function (name) {
            switch (name) {
                case 'setAction':
                    return this.setAction;
                default:
                    return null;
            }
        };
        BasePlugin.prototype.setAction = function (action, options) {
            this.action = action;
            this.actionData = options;
        };
        BasePlugin.prototype.clearData = function () {
            this.clearPluginData();
            this.action = undefined;
            this.actionData = {};
        };
        BasePlugin.prototype.getLocationInformation = function (eventType, payload) {
            return __assign({ hitType: eventType }, this.getNextValues(eventType, payload));
        };
        BasePlugin.prototype.updateLocationInformation = function (eventType, payload) {
            this.updateLocationForNextPageView(eventType, payload);
        };
        BasePlugin.prototype.getDefaultContextInformation = function (eventType) {
            var documentContext = {
                title: hasDocument() ? document.title : '',
                encoding: hasDocument() ? document.characterSet : 'UTF-8',
            };
            var screenContext = {
                screenResolution: "".concat(screen.width, "x").concat(screen.height),
                screenColor: "".concat(screen.colorDepth, "-bit"),
            };
            var navigatorContext = {
                language: navigator.language,
                userAgent: navigator.userAgent,
            };
            var eventContext = {
                time: Date.now(),
                eventId: this.uuidGenerator(),
            };
            return __assign(__assign(__assign(__assign({}, eventContext), screenContext), navigatorContext), documentContext);
        };
        BasePlugin.prototype.updateLocationForNextPageView = function (eventType, payload) {
            var _a = this.getNextValues(eventType, payload), pageViewId = _a.pageViewId, referrer = _a.referrer, location = _a.location;
            this.lastReferrer = referrer;
            this.pageViewId = pageViewId;
            this.currentLocation = location;
            if (eventType === BasePluginEventTypes.pageview) {
                this.nextPageViewId = this.uuidGenerator();
                this.hasSentFirstPageView = true;
            }
        };
        BasePlugin.prototype.getNextValues = function (eventType, payload) {
            return {
                pageViewId: eventType === BasePluginEventTypes.pageview ? this.nextPageViewId : this.pageViewId,
                referrer: eventType === BasePluginEventTypes.pageview && this.hasSentFirstPageView
                    ? this.currentLocation
                    : this.lastReferrer,
                location: eventType === BasePluginEventTypes.pageview
                    ? this.getCurrentLocationFromPayload(payload)
                    : this.currentLocation,
            };
        };
        BasePlugin.prototype.getCurrentLocationFromPayload = function (payload) {
            if (!!payload.page) {
                var removeStartingSlash = function (page) { return page.replace(/^\/?(.*)$/, '/$1'); };
                var extractHostnamePart = function (location) { return location.split('/').slice(0, 3).join('/'); };
                return "".concat(extractHostnamePart(this.currentLocation)).concat(removeStartingSlash(payload.page));
            }
            else {
                return getFormattedLocation(window.location);
            }
        };
        return BasePlugin;
    }(Plugin));

    var CoveoLinkParam = (function () {
        function CoveoLinkParam(clientId, timestamp) {
            if (!validate(clientId))
                throw Error('Not a valid uuid');
            this.clientId = clientId;
            this.creationDate = Math.floor(timestamp / 1000);
        }
        CoveoLinkParam.prototype.toString = function () {
            return this.clientId.replace(/-/g, '') + '.' + this.creationDate.toString();
        };
        Object.defineProperty(CoveoLinkParam.prototype, "expired", {
            get: function () {
                var age = Math.floor(Date.now() / 1000) - this.creationDate;
                return age < 0 || age > CoveoLinkParam.expirationTime;
            },
            enumerable: false,
            configurable: true
        });
        CoveoLinkParam.prototype.validate = function (referrerString, referrerList) {
            return !this.expired && this.matchReferrer(referrerString, referrerList);
        };
        CoveoLinkParam.prototype.matchReferrer = function (referrerString, referrerList) {
            try {
                var url_1 = new URL(referrerString);
                return referrerList.some(function (value) {
                    var hostRegExp = new RegExp(value.replace(/\\/g, '\\\\').replace(/\./g, '\\.').replace(/\*/g, '.*') + '$');
                    return hostRegExp.test(url_1.host);
                });
            }
            catch (error) {
                return false;
            }
        };
        CoveoLinkParam.fromString = function (input) {
            var parts = input.split('.');
            if (parts.length !== 2) {
                return null;
            }
            var clientIdPart = parts[0], creationDate = parts[1];
            if (clientIdPart.length !== 32 || isNaN(parseInt(creationDate))) {
                return null;
            }
            var clientId = clientIdPart.substring(0, 8) +
                '-' +
                clientIdPart.substring(8, 12) +
                '-' +
                clientIdPart.substring(12, 16) +
                '-' +
                clientIdPart.substring(16, 20) +
                '-' +
                clientIdPart.substring(20, 32);
            if (validate(clientId)) {
                return new CoveoLinkParam(clientId, Number.parseInt(creationDate) * 1000);
            }
            else {
                return null;
            }
        };
        CoveoLinkParam.cvo_cid = 'cvo_cid';
        CoveoLinkParam.expirationTime = 120;
        return CoveoLinkParam;
    }());
    var LinkPlugin = (function (_super) {
        __extends(LinkPlugin, _super);
        function LinkPlugin(_a) {
            var client = _a.client, _b = _a.uuidGenerator, uuidGenerator = _b === void 0 ? v4 : _b;
            return _super.call(this, { client: client, uuidGenerator: uuidGenerator }) || this;
        }
        LinkPlugin.prototype.getApi = function (name) {
            switch (name) {
                case 'decorate':
                    return this.decorate;
                case 'acceptFrom':
                    return this.acceptFrom;
                default:
                    return null;
            }
        };
        LinkPlugin.prototype.decorate = function (urlString) {
            return __awaiter(this, void 0, void 0, function () {
                var url, clientId;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            if (!this.client.getCurrentVisitorId) {
                                throw new Error('Could not retrieve current clientId');
                            }
                            _a.label = 1;
                        case 1:
                            _a.trys.push([1, 3, , 4]);
                            url = new URL(urlString);
                            return [4, this.client.getCurrentVisitorId()];
                        case 2:
                            clientId = _a.sent();
                            url.searchParams.set(CoveoLinkParam.cvo_cid, new CoveoLinkParam(clientId, Date.now()).toString());
                            return [2, url.toString()];
                        case 3:
                            _a.sent();
                            throw new Error('Invalid URL provided');
                        case 4: return [2];
                    }
                });
            });
        };
        LinkPlugin.prototype.acceptFrom = function (acceptedReferrers) {
            this.client.setAcceptedLinkReferrers(acceptedReferrers);
        };
        LinkPlugin.Id = 'link';
        return LinkPlugin;
    }(Plugin));
    var Link = LinkPlugin;

    var keysOf = Object.keys;
    function isObject(o) {
        return o !== null && typeof o === 'object' && !Array.isArray(o);
    }
    function coerceToNumber(input) {
        return typeof input === 'string' && input != '' && !Number.isNaN(+input) ? +input : input;
    }
    var UTF8_HIGH_BIT = 128;
    var UTF8_HEADER_2 = 192;
    var UTF8_HEADER_3 = 224;
    var UTF8_HEADER_4 = 240;
    function utf8ByteCountFromFirstByte(firstByte) {
        if ((firstByte & 248) === UTF8_HEADER_4) {
            return 4;
        }
        if ((firstByte & UTF8_HEADER_4) === UTF8_HEADER_3) {
            return 3;
        }
        if ((firstByte & UTF8_HEADER_3) === UTF8_HEADER_2) {
            return 2;
        }
        return 1;
    }
    function truncateUrl(input, limit) {
        if (limit < 0 || input.length <= limit) {
            return input;
        }
        var end = input.indexOf('%', limit - 2);
        if (end < 0 || end > limit) {
            end = limit;
        }
        else {
            limit = end;
        }
        while (end > 2 && input.charAt(end - 3) == '%') {
            var peekByte = Number.parseInt(input.substring(end - 2, end), 16);
            if ((peekByte & UTF8_HIGH_BIT) != UTF8_HIGH_BIT) {
                break;
            }
            end -= 3;
            if ((peekByte & UTF8_HEADER_2) != UTF8_HIGH_BIT) {
                if (limit - end >= utf8ByteCountFromFirstByte(peekByte) * 3) {
                    end = limit;
                }
                break;
            }
        }
        return input.substring(0, end);
    }

    var ticketKeysMapping = {
        id: 'svc_ticket_id',
        subject: 'svc_ticket_subject',
        description: 'svc_ticket_description',
        category: 'svc_ticket_category',
        productId: 'svc_ticket_product_id',
        custom: 'svc_ticket_custom',
    };
    var ticketKeysMappingValues = keysOf(ticketKeysMapping).map(function (key) { return ticketKeysMapping[key]; });
    var ticketSubKeysMatchGroup = __spreadArray([], ticketKeysMappingValues, true).join('|');
    var ticketKeyRegex = new RegExp("^(".concat(ticketSubKeysMatchGroup, "$)"));
    var serviceActionsKeysMapping = {
        svcAction: 'svc_action',
        svcActionData: 'svc_action_data',
    };
    var convertTicketToMeasurementProtocol = function (ticket) {
        return keysOf(ticket)
            .filter(function (key) { return ticket[key] !== undefined; })
            .reduce(function (mappedTicket, key) {
            var _a;
            var newKey = ticketKeysMapping[key] || key;
            return __assign(__assign({}, mappedTicket), (_a = {}, _a[newKey] = ticket[key], _a));
        }, {});
    };
    var isTicketKey = function (key) { return ticketKeyRegex.test(key); };
    var isServiceKey = [isTicketKey];

    var productKeysMapping = {
        id: 'id',
        name: 'nm',
        brand: 'br',
        category: 'ca',
        variant: 'va',
        price: 'pr',
        quantity: 'qt',
        coupon: 'cc',
        position: 'ps',
        group: 'group',
    };
    var impressionKeysMapping = {
        id: 'id',
        name: 'nm',
        brand: 'br',
        category: 'ca',
        variant: 'va',
        position: 'ps',
        price: 'pr',
        group: 'group',
    };
    var productActionsKeysMapping = {
        action: 'pa',
        list: 'pal',
        listSource: 'pls',
    };
    var transactionActionsKeysMapping = {
        id: 'ti',
        revenue: 'tr',
        tax: 'tt',
        shipping: 'ts',
        coupon: 'tcc',
        affiliation: 'ta',
        step: 'cos',
        option: 'col',
    };
    var coveoCommerceExtensionKeys = [
        'loyaltyCardId',
        'loyaltyTier',
        'thirdPartyPersona',
        'companyName',
        'favoriteStore',
        'storeName',
        'userIndustry',
        'userRole',
        'userDepartment',
        'businessUnit',
    ];
    var quoteActionsKeysMapping = {
        id: 'quoteId',
        affiliation: 'quoteAffiliation',
    };
    var reviewActionsKeysMapping = {
        id: 'reviewId',
        rating: 'reviewRating',
        comment: 'reviewComment',
    };
    var commerceActionKeysMappingPerAction = {
        add: productActionsKeysMapping,
        bookmark_add: productActionsKeysMapping,
        bookmark_remove: productActionsKeysMapping,
        click: productActionsKeysMapping,
        checkout: productActionsKeysMapping,
        checkout_option: productActionsKeysMapping,
        detail: productActionsKeysMapping,
        impression: productActionsKeysMapping,
        remove: productActionsKeysMapping,
        refund: __assign(__assign({}, productActionsKeysMapping), transactionActionsKeysMapping),
        purchase: __assign(__assign({}, productActionsKeysMapping), transactionActionsKeysMapping),
        quickview: productActionsKeysMapping,
        quote: __assign(__assign({}, productActionsKeysMapping), quoteActionsKeysMapping),
        review: __assign(__assign({}, productActionsKeysMapping), reviewActionsKeysMapping),
    };
    var convertProductToMeasurementProtocol = function (product, index) {
        return keysOf(product).reduce(function (mappedProduct, key) {
            var _a;
            var newKey = "pr".concat(index + 1).concat(productKeysMapping[key] || key);
            return __assign(__assign({}, mappedProduct), (_a = {}, _a[newKey] = product[key], _a));
        }, {});
    };
    var convertImpressionListToMeasurementProtocol = function (impressionList, listIndex, prefix) {
        var payload = impressionList.impressions.reduce(function (mappedImpressions, impression, productIndex) {
            return __assign(__assign({}, mappedImpressions), convertImpressionToMeasurementProtocol(impression, listIndex, productIndex, prefix));
        }, {});
        if (impressionList.listName) {
            var listNameKey = "il".concat(listIndex + 1, "nm");
            payload[listNameKey] = impressionList.listName;
        }
        return payload;
    };
    var convertImpressionToMeasurementProtocol = function (impression, listIndex, productIndex, prefix) {
        return keysOf(impression).reduce(function (mappedImpression, key) {
            var _a;
            var newKey = "il".concat(listIndex + 1).concat(prefix).concat(productIndex + 1).concat(impressionKeysMapping[key] || key);
            return __assign(__assign({}, mappedImpression), (_a = {}, _a[newKey] = impression[key], _a));
        }, {});
    };
    var productKeysMappingValues = keysOf(productKeysMapping).map(function (key) { return productKeysMapping[key]; });
    var impressionKeysMappingValues = keysOf(impressionKeysMapping).map(function (key) { return impressionKeysMapping[key]; });
    var productActionsKeysMappingValues = keysOf(productActionsKeysMapping).map(function (key) { return productActionsKeysMapping[key]; });
    var transactionActionsKeysMappingValues = keysOf(transactionActionsKeysMapping).map(function (key) { return transactionActionsKeysMapping[key]; });
    var reviewKeysMappingValues = keysOf(reviewActionsKeysMapping).map(function (key) { return reviewActionsKeysMapping[key]; });
    var quoteKeysMappingValues = keysOf(quoteActionsKeysMapping).map(function (key) { return quoteActionsKeysMapping[key]; });
    var productSubKeysMatchGroup = __spreadArray(__spreadArray([], productKeysMappingValues, true), ['custom'], false).join('|');
    var impressionSubKeysMatchGroup = __spreadArray(__spreadArray([], impressionKeysMappingValues, true), ['custom'], false).join('|');
    var productPrefixMatchGroup = '(pr[0-9]+)';
    var impressionPrefixMatchGroup = '(il[0-9]+pi[0-9]+)';
    var productKeyRegex = new RegExp("^".concat(productPrefixMatchGroup, "(").concat(productSubKeysMatchGroup, ")$"));
    var impressionKeyRegex = new RegExp("^(".concat(impressionPrefixMatchGroup, "(").concat(impressionSubKeysMatchGroup, "))|(il[0-9]+nm)$"));
    var productActionsKeyRegex = new RegExp("^(".concat(productActionsKeysMappingValues.join('|'), ")$"));
    var transactionActionsKeyRegex = new RegExp("^(".concat(transactionActionsKeysMappingValues.join('|'), ")$"));
    var customProductKeyRegex = new RegExp("^".concat(productPrefixMatchGroup, "custom$"));
    var customImpressionKeyRegex = new RegExp("^".concat(impressionPrefixMatchGroup, "custom$"));
    var coveoCommerceExtensionKeysRegex = new RegExp("^(".concat(__spreadArray(__spreadArray(__spreadArray([], coveoCommerceExtensionKeys, true), reviewKeysMappingValues, true), quoteKeysMappingValues, true).join('|'), ")$"));
    var isProductKey = function (key) { return productKeyRegex.test(key); };
    var isImpressionKey = function (key) { return impressionKeyRegex.test(key); };
    var isProductActionsKey = function (key) { return productActionsKeyRegex.test(key); };
    var isTransactionActionsKeyRegex = function (key) { return transactionActionsKeyRegex.test(key); };
    var isCoveoCommerceExtensionKey = function (key) { return coveoCommerceExtensionKeysRegex.test(key); };
    var isCommerceKey = [
        isImpressionKey,
        isProductKey,
        isProductActionsKey,
        isTransactionActionsKeyRegex,
        isCoveoCommerceExtensionKey,
    ];
    var isCustomCommerceKey = [customProductKeyRegex, customImpressionKeyRegex];

    var globalParamKeysMapping = {
        anonymizeIp: 'aip',
    };
    var eventKeysMapping = {
        eventCategory: 'ec',
        eventAction: 'ea',
        eventLabel: 'el',
        eventValue: 'ev',
        page: 'dp',
        visitorId: 'cid',
        clientId: 'cid',
        userId: 'uid',
        currencyCode: 'cu',
    };
    var contextInformationMapping = {
        hitType: 't',
        pageViewId: 'pid',
        encoding: 'de',
        location: 'dl',
        referrer: 'dr',
        screenColor: 'sd',
        screenResolution: 'sr',
        title: 'dt',
        userAgent: 'ua',
        language: 'ul',
        eventId: 'z',
        time: 'tm',
    };
    var coveoExtensionsKeys = [
        'contentId',
        'contentIdKey',
        'contentType',
        'searchHub',
        'tab',
        'searchUid',
        'permanentId',
        'contentLocale',
        'trackingId',
    ];
    var baseMeasurementProtocolKeysMapping = __assign(__assign(__assign(__assign({}, globalParamKeysMapping), eventKeysMapping), contextInformationMapping), coveoExtensionsKeys.reduce(function (all, key) {
        var _a;
        return (__assign(__assign({}, all), (_a = {}, _a[key] = key, _a)));
    }, {}));

    var measurementProtocolKeysMapping = __assign(__assign({}, baseMeasurementProtocolKeysMapping), serviceActionsKeysMapping);
    var convertKeysToMeasurementProtocol = function (params) {
        var keysMappingForAction = (!!params.action && commerceActionKeysMappingPerAction[params.action]) || {};
        return keysOf(params).reduce(function (mappedKeys, key) {
            var _a;
            var newKey = keysMappingForAction[key] || measurementProtocolKeysMapping[key] || key;
            return __assign(__assign({}, mappedKeys), (_a = {}, _a[newKey] = params[key], _a));
        }, {});
    };
    var measurementProtocolKeysMappingValues = keysOf(measurementProtocolKeysMapping).map(function (key) { return measurementProtocolKeysMapping[key]; });
    var isKnownMeasurementProtocolKey = function (key) { return measurementProtocolKeysMappingValues.indexOf(key) !== -1; };
    var isCustomKey = function (key) { return key === 'custom'; };
    var isMeasurementProtocolKey = function (key) {
        return __spreadArray(__spreadArray(__spreadArray([], isCommerceKey, true), isServiceKey, true), [isKnownMeasurementProtocolKey, isCustomKey], false).some(function (test) { return test(key); });
    };
    var convertCustomMeasurementProtocolKeys = function (data) {
        return keysOf(data).reduce(function (all, current) {
            var _a;
            var match = getFirstCustomMeasurementProtocolKeyMatch(current);
            if (match) {
                return __assign(__assign({}, all), convertCustomObject(match, data[current]));
            }
            else {
                return __assign(__assign({}, all), (_a = {}, _a[current] = data[current], _a));
            }
        }, {});
    };
    var getFirstCustomMeasurementProtocolKeyMatch = function (key) {
        var matchedKey = undefined;
        __spreadArray([], isCustomCommerceKey, true).every(function (regex) {
            var _a;
            matchedKey = (_a = regex.exec(key)) === null || _a === void 0 ? void 0 : _a[1];
            return !Boolean(matchedKey);
        });
        return matchedKey;
    };
    var convertCustomObject = function (prefix, customData) {
        return keysOf(customData).reduce(function (allCustom, currentCustomKey) {
            var _a;
            return (__assign(__assign({}, allCustom), (_a = {}, _a["".concat(prefix).concat(currentCustomKey)] = customData[currentCustomKey], _a)));
        }, {});
    };

    var AnalyticsBeaconClient = (function () {
        function AnalyticsBeaconClient(opts) {
            this.opts = opts;
        }
        AnalyticsBeaconClient.prototype.sendEvent = function (eventType, originalPayload) {
            return __awaiter(this, void 0, void 0, function () {
                var _a, baseUrl, preprocessRequest, paramsFragments, _b, url, payload, parsedRequestData, body;
                return __generator(this, function (_c) {
                    switch (_c.label) {
                        case 0:
                            if (!this.isAvailable()) {
                                throw new Error("navigator.sendBeacon is not supported in this browser. Consider adding a polyfill like \"sendbeacon-polyfill\".");
                            }
                            _a = this.opts, baseUrl = _a.baseUrl, preprocessRequest = _a.preprocessRequest;
                            return [4, this.getQueryParamsForEventType(eventType)];
                        case 1:
                            paramsFragments = _c.sent();
                            return [4, this.preProcessRequestAsPotentialJSONString("".concat(baseUrl, "/analytics/").concat(eventType, "?").concat(paramsFragments), originalPayload, preprocessRequest)];
                        case 2:
                            _b = _c.sent(), url = _b.url, payload = _b.payload;
                            parsedRequestData = this.encodeForEventType(eventType, payload);
                            body = new Blob([parsedRequestData], {
                                type: 'application/x-www-form-urlencoded',
                            });
                            navigator.sendBeacon(url, body);
                            return [2];
                    }
                });
            });
        };
        AnalyticsBeaconClient.prototype.isAvailable = function () {
            return 'sendBeacon' in navigator;
        };
        AnalyticsBeaconClient.prototype.deleteHttpCookieVisitorId = function () {
            return Promise.resolve();
        };
        AnalyticsBeaconClient.prototype.preProcessRequestAsPotentialJSONString = function (originalURL, originalPayload, preprocessRequest) {
            return __awaiter(this, void 0, void 0, function () {
                var returnedUrl, returnedPayload, processedRequest, processedURL, processedBody;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            returnedUrl = originalURL;
                            returnedPayload = originalPayload;
                            if (!preprocessRequest) return [3, 2];
                            return [4, preprocessRequest({ url: originalURL, body: JSON.stringify(originalPayload) }, 'analyticsBeacon')];
                        case 1:
                            processedRequest = _a.sent();
                            processedURL = processedRequest.url, processedBody = processedRequest.body;
                            returnedUrl = processedURL || originalURL;
                            try {
                                returnedPayload = JSON.parse(processedBody);
                            }
                            catch (e) {
                                console.error('Unable to process the request body as a JSON string', e);
                            }
                            _a.label = 2;
                        case 2: return [2, {
                                payload: returnedPayload,
                                url: returnedUrl,
                            }];
                    }
                });
            });
        };
        AnalyticsBeaconClient.prototype.encodeForEventType = function (eventType, payload) {
            return this.isEventTypeLegacy(eventType)
                ? this.encodeEventToJson(eventType, payload)
                : this.encodeEventToJson(eventType, payload, this.opts.token);
        };
        AnalyticsBeaconClient.prototype.getQueryParamsForEventType = function (eventType) {
            return __awaiter(this, void 0, void 0, function () {
                var _a, token, visitorIdProvider, visitorId;
                return __generator(this, function (_b) {
                    switch (_b.label) {
                        case 0:
                            _a = this.opts, token = _a.token, visitorIdProvider = _a.visitorIdProvider;
                            return [4, visitorIdProvider.getCurrentVisitorId()];
                        case 1:
                            visitorId = _b.sent();
                            return [2, [
                                    token && this.isEventTypeLegacy(eventType) ? "access_token=".concat(token) : '',
                                    visitorId ? "visitorId=".concat(visitorId) : '',
                                    'discardVisitInfo=true',
                                ]
                                    .filter(function (p) { return !!p; })
                                    .join('&')];
                    }
                });
            });
        };
        AnalyticsBeaconClient.prototype.isEventTypeLegacy = function (eventType) {
            return [EventType.click, EventType.custom, EventType.search, EventType.view].indexOf(eventType) !== -1;
        };
        AnalyticsBeaconClient.prototype.encodeEventToJson = function (eventType, payload, access_token) {
            var encoded = "".concat(eventType, "Event=").concat(encodeURIComponent(JSON.stringify(payload)));
            if (access_token) {
                encoded = "access_token=".concat(encodeURIComponent(access_token), "&").concat(encoded);
            }
            return encoded;
        };
        return AnalyticsBeaconClient;
    }());

    var NoopAnalyticsClient = (function () {
        function NoopAnalyticsClient() {
        }
        NoopAnalyticsClient.prototype.sendEvent = function (_, __) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    return [2, Promise.resolve()];
                });
            });
        };
        NoopAnalyticsClient.prototype.deleteHttpCookieVisitorId = function () {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    return [2, Promise.resolve()];
                });
            });
        };
        return NoopAnalyticsClient;
    }());

    var fetch$2 = globalThis.fetch;

    var AnalyticsFetchClient = (function () {
        function AnalyticsFetchClient(opts) {
            this.opts = opts;
        }
        AnalyticsFetchClient.prototype.sendEvent = function (eventType, payload) {
            return __awaiter(this, void 0, void 0, function () {
                var _a, baseUrl, visitorIdProvider, preprocessRequest, visitorIdParam, _b, defaultOptions, _c, url, fetchData, _d, _e, response, error_1, visit;
                return __generator(this, function (_f) {
                    switch (_f.label) {
                        case 0:
                            _a = this.opts, baseUrl = _a.baseUrl, visitorIdProvider = _a.visitorIdProvider, preprocessRequest = _a.preprocessRequest;
                            if (!this.shouldAppendVisitorId(eventType)) return [3, 2];
                            return [4, this.getVisitorIdParam()];
                        case 1:
                            _b = _f.sent();
                            return [3, 3];
                        case 2:
                            _b = '';
                            _f.label = 3;
                        case 3:
                            visitorIdParam = _b;
                            defaultOptions = {
                                url: "".concat(baseUrl, "/analytics/").concat(eventType).concat(visitorIdParam),
                                credentials: 'include',
                                mode: 'cors',
                                headers: this.getHeaders(),
                                method: 'POST',
                                body: JSON.stringify(payload),
                            };
                            _d = [__assign({}, defaultOptions)];
                            if (!preprocessRequest) return [3, 5];
                            return [4, preprocessRequest(defaultOptions, 'analyticsFetch')];
                        case 4:
                            _e = _f.sent();
                            return [3, 6];
                        case 5:
                            _e = {};
                            _f.label = 6;
                        case 6:
                            _c = __assign.apply(void 0, _d.concat([(_e)])), url = _c.url, fetchData = __rest(_c, ["url"]);
                            _f.label = 7;
                        case 7:
                            _f.trys.push([7, 9, , 10]);
                            return [4, fetch$2(url, fetchData)];
                        case 8:
                            response = _f.sent();
                            return [3, 10];
                        case 9:
                            error_1 = _f.sent();
                            console.error('An error has occured when sending the event.', error_1);
                            return [2];
                        case 10:
                            if (!response.ok) return [3, 12];
                            return [4, response.json()];
                        case 11:
                            visit = (_f.sent());
                            if (visit.visitorId) {
                                visitorIdProvider.setCurrentVisitorId(visit.visitorId);
                            }
                            return [2, visit];
                        case 12:
                            try {
                                response.json();
                            }
                            catch (_g) {
                            }
                            console.error("An error has occured when sending the \"".concat(eventType, "\" event."), response, payload);
                            throw new Error("An error has occurred when sending the \"".concat(eventType, "\" event. Check the console logs for more details."));
                    }
                });
            });
        };
        AnalyticsFetchClient.prototype.deleteHttpCookieVisitorId = function () {
            return __awaiter(this, void 0, void 0, function () {
                var baseUrl, url;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            baseUrl = this.opts.baseUrl;
                            url = "".concat(baseUrl, "/analytics/visit");
                            return [4, fetch$2(url, { headers: this.getHeaders(), method: 'DELETE' })];
                        case 1:
                            _a.sent();
                            return [2];
                    }
                });
            });
        };
        AnalyticsFetchClient.prototype.shouldAppendVisitorId = function (eventType) {
            return [EventType.click, EventType.custom, EventType.search, EventType.view].indexOf(eventType) !== -1;
        };
        AnalyticsFetchClient.prototype.getVisitorIdParam = function () {
            return __awaiter(this, void 0, void 0, function () {
                var visitorIdProvider, visitorId;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            visitorIdProvider = this.opts.visitorIdProvider;
                            return [4, visitorIdProvider.getCurrentVisitorId()];
                        case 1:
                            visitorId = _a.sent();
                            return [2, visitorId ? "?visitor=".concat(visitorId) : ''];
                    }
                });
            });
        };
        AnalyticsFetchClient.prototype.getHeaders = function () {
            var token = this.opts.token;
            return __assign(__assign({}, (token ? { Authorization: "Bearer ".concat(token) } : {})), { 'Content-Type': "application/json" });
        };
        return AnalyticsFetchClient;
    }());

    var BrowserRuntime = (function () {
        function BrowserRuntime(clientOptions, getUnprocessedRequests) {
            var _this = this;
            if (hasLocalStorage() && hasCookieStorage()) {
                this.storage = new CookieAndLocalStorage();
            }
            else if (hasLocalStorage()) {
                this.storage = localStorage;
            }
            else {
                console.warn('BrowserRuntime detected no valid storage available.', this);
                this.storage = new NullStorage();
            }
            this.client = new AnalyticsFetchClient(clientOptions);
            this.beaconClient = new AnalyticsBeaconClient(clientOptions);
            window.addEventListener('beforeunload', function () {
                var requests = getUnprocessedRequests();
                for (var _i = 0, requests_1 = requests; _i < requests_1.length; _i++) {
                    var _a = requests_1[_i], eventType = _a.eventType, payload = _a.payload;
                    _this.beaconClient.sendEvent(eventType, payload);
                }
            });
        }
        BrowserRuntime.prototype.getClientDependingOnEventType = function (eventType) {
            return eventType === 'click' && this.beaconClient.isAvailable() ? this.beaconClient : this.client;
        };
        return BrowserRuntime;
    }());
    var NodeJSRuntime = (function () {
        function NodeJSRuntime(clientOptions, storage) {
            this.storage = storage || new NullStorage();
            this.client = new AnalyticsFetchClient(clientOptions);
        }
        NodeJSRuntime.prototype.getClientDependingOnEventType = function (eventType) {
            return this.client;
        };
        return NodeJSRuntime;
    }());
    var NoopRuntime = (function () {
        function NoopRuntime() {
            this.storage = new NullStorage();
            this.client = new NoopAnalyticsClient();
        }
        NoopRuntime.prototype.getClientDependingOnEventType = function (eventType) {
            return this.client;
        };
        return NoopRuntime;
    }());

    var API_KEY_PREFIX = 'xx';
    var isApiKey = function (token) { return (token === null || token === void 0 ? void 0 : token.startsWith(API_KEY_PREFIX)) || false; };

    var ReactNativeRuntimeWarning = "\n        We've detected you're using React Native but have not provided the corresponding runtime, \n        for an optimal experience please use the \"coveo.analytics/react-native\" subpackage.\n        Follow the Readme on how to set it up: https://github.com/coveo/coveo.analytics.js#using-react-native\n    ";
    function isReactNative() {
        return typeof navigator != 'undefined' && navigator.product == 'ReactNative';
    }

    var doNotTrackValues = ['1', 1, 'yes', true];
    function doNotTrack() {
        var checks = [];
        if (hasWindow()) {
            checks.push(window.doNotTrack);
        }
        if (hasNavigator()) {
            checks.push(navigator.doNotTrack, navigator.msDoNotTrack, navigator.globalPrivacyControl);
        }
        return checks.some(function (value) { return doNotTrackValues.indexOf(value) !== -1; });
    }

    var donottrack = /*#__PURE__*/Object.freeze({
        __proto__: null,
        default: doNotTrack,
        doNotTrack: doNotTrack
    });

    var Version = 'v15';
    var Endpoints = {
        default: 'https://analytics.cloud.coveo.com/rest/ua',
        production: 'https://analytics.cloud.coveo.com/rest/ua',
        hipaa: 'https://analyticshipaa.cloud.coveo.com/rest/ua',
    };
    function buildBaseUrl(endpoint, apiVersion, isCustomEndpoint) {
        if (endpoint === void 0) { endpoint = Endpoints.default; }
        if (apiVersion === void 0) { apiVersion = Version; }
        if (isCustomEndpoint === void 0) { isCustomEndpoint = false; }
        endpoint = endpoint.replace(/\/$/, '');
        if (isCustomEndpoint) {
            return "".concat(endpoint, "/").concat(apiVersion);
        }
        var hasUARestEndpoint = endpoint.endsWith('/rest') || endpoint.endsWith('/rest/ua');
        return "".concat(endpoint).concat(hasUARestEndpoint ? '' : '/rest', "/").concat(apiVersion);
    }
    var COVEO_NAMESPACE = '38824e1f-37f5-42d3-8372-a4b8fa9df946';
    var CoveoAnalyticsClient = (function () {
        function CoveoAnalyticsClient(opts) {
            this.acceptedLinkReferrers = [];
            if (!opts) {
                throw new Error('You have to pass options to this constructor');
            }
            this.options = __assign(__assign({}, this.defaultOptions), opts);
            this.visitorId = '';
            this.bufferedRequests = [];
            this.beforeSendHooks = [enhanceViewEvent, addDefaultValues].concat(this.options.beforeSendHooks);
            this.afterSendHooks = this.options.afterSendHooks;
            this.eventTypeMapping = {};
            var clientsOptions = {
                baseUrl: this.baseUrl,
                token: this.options.token,
                visitorIdProvider: this,
                preprocessRequest: this.options.preprocessRequest,
            };
            if (doNotTrack()) {
                this.runtime = new NoopRuntime();
            }
            else {
                this.runtime = this.options.runtimeEnvironment || this.initRuntime(clientsOptions);
            }
            this.addEventTypeMapping(EventType.view, { newEventType: EventType.view, addClientIdParameter: true });
            this.addEventTypeMapping(EventType.click, { newEventType: EventType.click, addClientIdParameter: true });
            this.addEventTypeMapping(EventType.custom, { newEventType: EventType.custom, addClientIdParameter: true });
            this.addEventTypeMapping(EventType.search, { newEventType: EventType.search, addClientIdParameter: true });
        }
        Object.defineProperty(CoveoAnalyticsClient.prototype, "defaultOptions", {
            get: function () {
                return {
                    endpoint: Endpoints.default,
                    isCustomEndpoint: false,
                    token: '',
                    version: Version,
                    beforeSendHooks: [],
                    afterSendHooks: [],
                };
            },
            enumerable: false,
            configurable: true
        });
        Object.defineProperty(CoveoAnalyticsClient.prototype, "version", {
            get: function () {
                return libVersion;
            },
            enumerable: false,
            configurable: true
        });
        CoveoAnalyticsClient.prototype.initRuntime = function (clientsOptions) {
            var _this = this;
            if (hasWindow() && hasDocument()) {
                return new BrowserRuntime(clientsOptions, function () {
                    var copy = __spreadArray([], _this.bufferedRequests, true);
                    _this.bufferedRequests = [];
                    return copy;
                });
            }
            else if (isReactNative()) {
                console.warn(ReactNativeRuntimeWarning);
            }
            return new NodeJSRuntime(clientsOptions);
        };
        Object.defineProperty(CoveoAnalyticsClient.prototype, "storage", {
            get: function () {
                return this.runtime.storage;
            },
            enumerable: false,
            configurable: true
        });
        CoveoAnalyticsClient.prototype.determineVisitorId = function () {
            return __awaiter(this, void 0, void 0, function () {
                var _a, err_1;
                return __generator(this, function (_b) {
                    switch (_b.label) {
                        case 0:
                            _b.trys.push([0, 3, , 4]);
                            _a = (hasWindow() && this.extractClientIdFromLink(window.location.href));
                            if (_a) return [3, 2];
                            return [4, this.storage.getItem('visitorId')];
                        case 1:
                            _a = (_b.sent());
                            _b.label = 2;
                        case 2: return [2, (_a ||
                                v4())];
                        case 3:
                            err_1 = _b.sent();
                            console.log('Could not get visitor ID from the current runtime environment storage. Using a random ID instead.', err_1);
                            return [2, v4()];
                        case 4: return [2];
                    }
                });
            });
        };
        CoveoAnalyticsClient.prototype.getCurrentVisitorId = function () {
            return __awaiter(this, void 0, void 0, function () {
                var id;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            if (!!this.visitorId) return [3, 3];
                            return [4, this.determineVisitorId()];
                        case 1:
                            id = _a.sent();
                            return [4, this.setCurrentVisitorId(id)];
                        case 2:
                            _a.sent();
                            _a.label = 3;
                        case 3: return [2, this.visitorId];
                    }
                });
            });
        };
        CoveoAnalyticsClient.prototype.setCurrentVisitorId = function (visitorId) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            this.visitorId = visitorId;
                            return [4, this.storage.setItem('visitorId', visitorId)];
                        case 1:
                            _a.sent();
                            return [2];
                    }
                });
            });
        };
        CoveoAnalyticsClient.prototype.setClientId = function (value, namespace) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    if (validate(value)) {
                        this.setCurrentVisitorId(value.toLowerCase());
                    }
                    else {
                        if (!namespace) {
                            throw Error('Cannot generate uuid client id without a specific namespace string.');
                        }
                        this.setCurrentVisitorId(uuidv5(value, uuidv5(namespace, COVEO_NAMESPACE)));
                    }
                    return [2];
                });
            });
        };
        CoveoAnalyticsClient.prototype.getParameters = function (eventType) {
            var payload = [];
            for (var _i = 1; _i < arguments.length; _i++) {
                payload[_i - 1] = arguments[_i];
            }
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.resolveParameters.apply(this, __spreadArray([eventType], payload, false))];
                        case 1: return [2, _a.sent()];
                    }
                });
            });
        };
        CoveoAnalyticsClient.prototype.getPayload = function (eventType) {
            var payload = [];
            for (var _i = 1; _i < arguments.length; _i++) {
                payload[_i - 1] = arguments[_i];
            }
            return __awaiter(this, void 0, void 0, function () {
                var parametersToSend;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.resolveParameters.apply(this, __spreadArray([eventType], payload, false))];
                        case 1:
                            parametersToSend = _a.sent();
                            return [4, this.resolvePayloadForParameters(eventType, parametersToSend)];
                        case 2: return [2, _a.sent()];
                    }
                });
            });
        };
        Object.defineProperty(CoveoAnalyticsClient.prototype, "currentVisitorId", {
            get: function () {
                var visitorId = this.visitorId || this.storage.getItem('visitorId');
                if (typeof visitorId !== 'string') {
                    this.setCurrentVisitorId(v4());
                }
                return this.visitorId;
            },
            set: function (visitorId) {
                this.visitorId = visitorId;
                this.storage.setItem('visitorId', visitorId);
            },
            enumerable: false,
            configurable: true
        });
        CoveoAnalyticsClient.prototype.extractClientIdFromLink = function (urlString) {
            if (doNotTrack()) {
                return null;
            }
            try {
                var linkParam = new URL(urlString).searchParams.get(CoveoLinkParam.cvo_cid);
                if (linkParam == null) {
                    return null;
                }
                var linker = CoveoLinkParam.fromString(linkParam);
                if (!linker || !hasDocument() || !linker.validate(document.referrer, this.acceptedLinkReferrers)) {
                    return null;
                }
                return linker.clientId;
            }
            catch (error) {
            }
            return null;
        };
        CoveoAnalyticsClient.prototype.resolveParameters = function (eventType) {
            var payload = [];
            for (var _i = 1; _i < arguments.length; _i++) {
                payload[_i - 1] = arguments[_i];
            }
            return __awaiter(this, void 0, void 0, function () {
                var _a, _b, variableLengthArgumentsNames, _c, addVisitorIdParameter, _d, usesMeasurementProtocol, _e, addClientIdParameter, processVariableArgumentNamesStep, addVisitorIdStep, addClientIdStep, setAnonymousUserStep, processBeforeSendHooksStep, parametersToSend;
                var _this = this;
                return __generator(this, function (_f) {
                    switch (_f.label) {
                        case 0:
                            _a = this.eventTypeMapping[eventType] || {}, _b = _a.variableLengthArgumentsNames, variableLengthArgumentsNames = _b === void 0 ? [] : _b, _c = _a.addVisitorIdParameter, addVisitorIdParameter = _c === void 0 ? false : _c, _d = _a.usesMeasurementProtocol, usesMeasurementProtocol = _d === void 0 ? false : _d, _e = _a.addClientIdParameter, addClientIdParameter = _e === void 0 ? false : _e;
                            processVariableArgumentNamesStep = function (currentPayload) {
                                return variableLengthArgumentsNames.length > 0
                                    ? _this.parseVariableArgumentsPayload(variableLengthArgumentsNames, currentPayload)
                                    : currentPayload[0];
                            };
                            addVisitorIdStep = function (currentPayload) { return __awaiter(_this, void 0, void 0, function () {
                                var _a, _b;
                                var _c;
                                return __generator(this, function (_d) {
                                    switch (_d.label) {
                                        case 0:
                                            _a = [__assign({}, currentPayload)];
                                            _c = {};
                                            if (!addVisitorIdParameter) return [3, 2];
                                            return [4, this.getCurrentVisitorId()];
                                        case 1:
                                            _b = _d.sent();
                                            return [3, 3];
                                        case 2:
                                            _b = '';
                                            _d.label = 3;
                                        case 3: return [2, (__assign.apply(void 0, _a.concat([(_c.visitorId = _b, _c)])))];
                                    }
                                });
                            }); };
                            addClientIdStep = function (currentPayload) { return __awaiter(_this, void 0, void 0, function () {
                                var _a;
                                var _b;
                                return __generator(this, function (_c) {
                                    switch (_c.label) {
                                        case 0:
                                            if (!addClientIdParameter) return [3, 2];
                                            _a = [__assign({}, currentPayload)];
                                            _b = {};
                                            return [4, this.getCurrentVisitorId()];
                                        case 1: return [2, __assign.apply(void 0, _a.concat([(_b.clientId = _c.sent(), _b)]))];
                                        case 2: return [2, currentPayload];
                                    }
                                });
                            }); };
                            setAnonymousUserStep = function (currentPayload) {
                                return usesMeasurementProtocol ? _this.ensureAnonymousUserWhenUsingApiKey(currentPayload) : currentPayload;
                            };
                            processBeforeSendHooksStep = function (currentPayload) {
                                return _this.beforeSendHooks.reduce(function (promisePayload, current) { return __awaiter(_this, void 0, void 0, function () {
                                    var payload;
                                    return __generator(this, function (_a) {
                                        switch (_a.label) {
                                            case 0: return [4, promisePayload];
                                            case 1:
                                                payload = _a.sent();
                                                return [4, current(eventType, payload)];
                                            case 2: return [2, _a.sent()];
                                        }
                                    });
                                }); }, currentPayload);
                            };
                            return [4, [
                                    processVariableArgumentNamesStep,
                                    addVisitorIdStep,
                                    addClientIdStep,
                                    setAnonymousUserStep,
                                    processBeforeSendHooksStep,
                                ].reduce(function (payloadPromise, step) { return __awaiter(_this, void 0, void 0, function () {
                                    var payload;
                                    return __generator(this, function (_a) {
                                        switch (_a.label) {
                                            case 0: return [4, payloadPromise];
                                            case 1:
                                                payload = _a.sent();
                                                return [4, step(payload)];
                                            case 2: return [2, _a.sent()];
                                        }
                                    });
                                }); }, Promise.resolve(payload))];
                        case 1:
                            parametersToSend = _f.sent();
                            return [2, parametersToSend];
                    }
                });
            });
        };
        CoveoAnalyticsClient.prototype.resolvePayloadForParameters = function (eventType, parameters) {
            return __awaiter(this, void 0, void 0, function () {
                var _a, usesMeasurementProtocol, addTrackingIdStep, cleanPayloadStep, validateParams, processMeasurementProtocolConversionStep, removeUnknownParameters, processCustomParameters, payloadToSend;
                var _this = this;
                return __generator(this, function (_b) {
                    switch (_b.label) {
                        case 0:
                            _a = (this.eventTypeMapping[eventType] || {}).usesMeasurementProtocol, usesMeasurementProtocol = _a === void 0 ? false : _a;
                            addTrackingIdStep = function (currentPayload) {
                                return _this.setTrackingIdIfTrackingIdNotPresent(currentPayload);
                            };
                            cleanPayloadStep = function (currentPayload) {
                                return _this.removeEmptyPayloadValues(currentPayload, eventType);
                            };
                            validateParams = function (currentPayload) { return _this.validateParams(currentPayload, eventType); };
                            processMeasurementProtocolConversionStep = function (currentPayload) {
                                return usesMeasurementProtocol ? convertKeysToMeasurementProtocol(currentPayload) : currentPayload;
                            };
                            removeUnknownParameters = function (currentPayload) {
                                return usesMeasurementProtocol ? _this.removeUnknownParameters(currentPayload) : currentPayload;
                            };
                            processCustomParameters = function (currentPayload) {
                                return usesMeasurementProtocol
                                    ? _this.processCustomParameters(currentPayload)
                                    : _this.mapCustomParametersToCustomData(currentPayload);
                            };
                            return [4, [
                                    addTrackingIdStep,
                                    cleanPayloadStep,
                                    validateParams,
                                    processMeasurementProtocolConversionStep,
                                    removeUnknownParameters,
                                    processCustomParameters,
                                ].reduce(function (payloadPromise, step) { return __awaiter(_this, void 0, void 0, function () {
                                    var payload;
                                    return __generator(this, function (_a) {
                                        switch (_a.label) {
                                            case 0: return [4, payloadPromise];
                                            case 1:
                                                payload = _a.sent();
                                                return [4, step(payload)];
                                            case 2: return [2, _a.sent()];
                                        }
                                    });
                                }); }, Promise.resolve(parameters))];
                        case 1:
                            payloadToSend = _b.sent();
                            return [2, payloadToSend];
                    }
                });
            });
        };
        CoveoAnalyticsClient.prototype.makeEvent = function (eventType) {
            var payload = [];
            for (var _i = 1; _i < arguments.length; _i++) {
                payload[_i - 1] = arguments[_i];
            }
            return __awaiter(this, void 0, void 0, function () {
                var _a, eventTypeToSend, parametersToSend, payloadToSend;
                var _this = this;
                return __generator(this, function (_b) {
                    switch (_b.label) {
                        case 0:
                            _a = (this.eventTypeMapping[eventType] || {}).newEventType, eventTypeToSend = _a === void 0 ? eventType : _a;
                            return [4, this.resolveParameters.apply(this, __spreadArray([eventType], payload, false))];
                        case 1:
                            parametersToSend = _b.sent();
                            return [4, this.resolvePayloadForParameters(eventType, parametersToSend)];
                        case 2:
                            payloadToSend = _b.sent();
                            return [2, {
                                    eventType: eventTypeToSend,
                                    payload: payloadToSend,
                                    log: function (remainingPayload) { return __awaiter(_this, void 0, void 0, function () {
                                        return __generator(this, function (_a) {
                                            switch (_a.label) {
                                                case 0:
                                                    this.bufferedRequests.push({
                                                        eventType: eventTypeToSend,
                                                        payload: __assign(__assign({}, payloadToSend), remainingPayload),
                                                    });
                                                    return [4, Promise.all(this.afterSendHooks.map(function (hook) { return hook(eventType, __assign(__assign({}, parametersToSend), remainingPayload)); }))];
                                                case 1:
                                                    _a.sent();
                                                    return [4, this.deferExecution()];
                                                case 2:
                                                    _a.sent();
                                                    return [4, this.sendFromBuffer()];
                                                case 3: return [2, (_a.sent())];
                                            }
                                        });
                                    }); },
                                }];
                    }
                });
            });
        };
        CoveoAnalyticsClient.prototype.sendEvent = function (eventType) {
            var payload = [];
            for (var _i = 1; _i < arguments.length; _i++) {
                payload[_i - 1] = arguments[_i];
            }
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeEvent.apply(this, __spreadArray([eventType], payload, false))];
                        case 1: return [2, (_a.sent()).log({})];
                    }
                });
            });
        };
        CoveoAnalyticsClient.prototype.deferExecution = function () {
            return new Promise(function (resolve) { return setTimeout(resolve, 0); });
        };
        CoveoAnalyticsClient.prototype.sendFromBuffer = function () {
            return __awaiter(this, void 0, void 0, function () {
                var popped, eventType, payload;
                return __generator(this, function (_a) {
                    popped = this.bufferedRequests.shift();
                    if (popped) {
                        eventType = popped.eventType, payload = popped.payload;
                        return [2, this.runtime.getClientDependingOnEventType(eventType).sendEvent(eventType, payload)];
                    }
                    return [2];
                });
            });
        };
        CoveoAnalyticsClient.prototype.clear = function () {
            this.storage.removeItem('visitorId');
            var store = new HistoryStore();
            store.clear();
        };
        CoveoAnalyticsClient.prototype.deleteHttpOnlyVisitorId = function () {
            this.runtime.client.deleteHttpCookieVisitorId();
        };
        CoveoAnalyticsClient.prototype.makeSearchEvent = function (request) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    return [2, this.makeEvent(EventType.search, request)];
                });
            });
        };
        CoveoAnalyticsClient.prototype.sendSearchEvent = function (_a) {
            return __awaiter(this, void 0, void 0, function () {
                var searchQueryUid = _a.searchQueryUid, preparedRequest = __rest(_a, ["searchQueryUid"]);
                return __generator(this, function (_b) {
                    switch (_b.label) {
                        case 0: return [4, this.makeSearchEvent(preparedRequest)];
                        case 1: return [2, (_b.sent()).log({ searchQueryUid: searchQueryUid })];
                    }
                });
            });
        };
        CoveoAnalyticsClient.prototype.makeClickEvent = function (request) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    return [2, this.makeEvent(EventType.click, request)];
                });
            });
        };
        CoveoAnalyticsClient.prototype.sendClickEvent = function (_a) {
            return __awaiter(this, void 0, void 0, function () {
                var searchQueryUid = _a.searchQueryUid, preparedRequest = __rest(_a, ["searchQueryUid"]);
                return __generator(this, function (_b) {
                    switch (_b.label) {
                        case 0: return [4, this.makeClickEvent(preparedRequest)];
                        case 1: return [2, (_b.sent()).log({ searchQueryUid: searchQueryUid })];
                    }
                });
            });
        };
        CoveoAnalyticsClient.prototype.makeCustomEvent = function (request) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    return [2, this.makeEvent(EventType.custom, request)];
                });
            });
        };
        CoveoAnalyticsClient.prototype.sendCustomEvent = function (_a) {
            return __awaiter(this, void 0, void 0, function () {
                var lastSearchQueryUid = _a.lastSearchQueryUid, preparedRequest = __rest(_a, ["lastSearchQueryUid"]);
                return __generator(this, function (_b) {
                    switch (_b.label) {
                        case 0: return [4, this.makeCustomEvent(preparedRequest)];
                        case 1: return [2, (_b.sent()).log({ lastSearchQueryUid: lastSearchQueryUid })];
                    }
                });
            });
        };
        CoveoAnalyticsClient.prototype.makeViewEvent = function (request) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    return [2, this.makeEvent(EventType.view, request)];
                });
            });
        };
        CoveoAnalyticsClient.prototype.sendViewEvent = function (request) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeViewEvent(request)];
                        case 1: return [2, (_a.sent()).log({})];
                    }
                });
            });
        };
        CoveoAnalyticsClient.prototype.getVisit = function () {
            return __awaiter(this, void 0, void 0, function () {
                var response, visit;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, fetch("".concat(this.baseUrl, "/analytics/visit"))];
                        case 1:
                            response = _a.sent();
                            return [4, response.json()];
                        case 2:
                            visit = (_a.sent());
                            this.visitorId = visit.visitorId;
                            return [2, visit];
                    }
                });
            });
        };
        CoveoAnalyticsClient.prototype.getHealth = function () {
            return __awaiter(this, void 0, void 0, function () {
                var response;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, fetch("".concat(this.baseUrl, "/analytics/monitoring/health"))];
                        case 1:
                            response = _a.sent();
                            return [4, response.json()];
                        case 2: return [2, (_a.sent())];
                    }
                });
            });
        };
        CoveoAnalyticsClient.prototype.registerBeforeSendEventHook = function (hook) {
            this.beforeSendHooks.push(hook);
        };
        CoveoAnalyticsClient.prototype.registerAfterSendEventHook = function (hook) {
            this.afterSendHooks.push(hook);
        };
        CoveoAnalyticsClient.prototype.addEventTypeMapping = function (eventType, eventConfig) {
            this.eventTypeMapping[eventType] = eventConfig;
        };
        CoveoAnalyticsClient.prototype.setAcceptedLinkReferrers = function (hosts) {
            if (Array.isArray(hosts) && hosts.every(function (host) { return typeof host == 'string'; }))
                this.acceptedLinkReferrers = hosts;
            else
                throw Error('Parameter should be an array of domain strings');
        };
        CoveoAnalyticsClient.prototype.parseVariableArgumentsPayload = function (fieldsOrder, payload) {
            var parsedArguments = {};
            for (var i = 0, length_1 = payload.length; i < length_1; i++) {
                var currentArgument = payload[i];
                if (typeof currentArgument === 'string') {
                    parsedArguments[fieldsOrder[i]] = currentArgument;
                }
                else if (typeof currentArgument === 'object') {
                    return __assign(__assign({}, parsedArguments), currentArgument);
                }
            }
            return parsedArguments;
        };
        CoveoAnalyticsClient.prototype.isKeyAllowedEmpty = function (evtType, key) {
            var _a;
            var keysThatCanBeEmpty = (_a = {},
                _a[EventType.search] = ['queryText'],
                _a);
            var match = keysThatCanBeEmpty[evtType] || [];
            return match.indexOf(key) !== -1;
        };
        CoveoAnalyticsClient.prototype.removeEmptyPayloadValues = function (payload, eventType) {
            var _this = this;
            var isNotEmptyValue = function (value) { return typeof value !== 'undefined' && value !== null && value !== ''; };
            return Object.keys(payload)
                .filter(function (key) { return _this.isKeyAllowedEmpty(eventType, key) || isNotEmptyValue(payload[key]); })
                .reduce(function (newPayload, key) {
                var _a;
                return (__assign(__assign({}, newPayload), (_a = {}, _a[key] = payload[key], _a)));
            }, {});
        };
        CoveoAnalyticsClient.prototype.removeUnknownParameters = function (payload) {
            var newPayload = Object.keys(payload)
                .filter(function (key) {
                if (isMeasurementProtocolKey(key)) {
                    return true;
                }
                else {
                    console.log(key, 'is not processed by coveoua');
                }
            })
                .reduce(function (newPayload, key) {
                var _a;
                return (__assign(__assign({}, newPayload), (_a = {}, _a[key] = payload[key], _a)));
            }, {});
            return newPayload;
        };
        CoveoAnalyticsClient.prototype.processCustomParameters = function (payload) {
            var custom = payload.custom, rest = __rest(payload, ["custom"]);
            var lowercasedCustom = {};
            if (custom && isObject(custom)) {
                lowercasedCustom = this.lowercaseKeys(custom);
            }
            var newPayload = convertCustomMeasurementProtocolKeys(rest);
            return __assign(__assign({}, lowercasedCustom), newPayload);
        };
        CoveoAnalyticsClient.prototype.mapCustomParametersToCustomData = function (payload) {
            var custom = payload.custom, rest = __rest(payload, ["custom"]);
            if (custom && isObject(custom)) {
                var lowercasedCustom = this.lowercaseKeys(custom);
                return __assign(__assign({}, rest), { customData: __assign(__assign({}, lowercasedCustom), payload.customData) });
            }
            else {
                return payload;
            }
        };
        CoveoAnalyticsClient.prototype.lowercaseKeys = function (custom) {
            var keys = Object.keys(custom);
            var result = {};
            keys.forEach(function (key) {
                result[key.toLowerCase()] = custom[key];
            });
            return result;
        };
        CoveoAnalyticsClient.prototype.validateParams = function (payload, eventType) {
            var anonymizeIp = payload.anonymizeIp, rest = __rest(payload, ["anonymizeIp"]);
            if (anonymizeIp !== undefined) {
                if (['0', 'false', 'undefined', 'null', '{}', '[]', ''].indexOf("".concat(anonymizeIp).toLowerCase()) == -1) {
                    rest.anonymizeIp = 1;
                }
            }
            if (eventType == EventType.view ||
                eventType == EventType.click ||
                eventType == EventType.search ||
                eventType == EventType.custom) {
                rest.originLevel3 = this.limit(rest.originLevel3, 1024);
            }
            if (eventType == EventType.view) {
                rest.location = this.limit(rest.location, 1024);
            }
            if (eventType == 'pageview' || eventType == 'event') {
                rest.referrer = this.limit(rest.referrer, 2048);
                rest.location = this.limit(rest.location, 2048);
                rest.page = this.limit(rest.page, 2048);
            }
            return rest;
        };
        CoveoAnalyticsClient.prototype.ensureAnonymousUserWhenUsingApiKey = function (payload) {
            var userId = payload.userId, rest = __rest(payload, ["userId"]);
            if (isApiKey(this.options.token) && !userId) {
                rest['userId'] = 'anonymous';
                return rest;
            }
            else {
                return payload;
            }
        };
        CoveoAnalyticsClient.prototype.setTrackingIdIfTrackingIdNotPresent = function (payload) {
            var trackingId = payload.trackingId, rest = __rest(payload, ["trackingId"]);
            if (trackingId) {
                return payload;
            }
            if (rest.hasOwnProperty('custom') && isObject(rest.custom)) {
                if (rest.custom.hasOwnProperty('context_website') || rest.custom.hasOwnProperty('siteName')) {
                    rest['trackingId'] = rest.custom.context_website || rest.custom.siteName;
                }
            }
            if (rest.hasOwnProperty('customData') && isObject(rest.customData)) {
                if (rest.customData.hasOwnProperty('context_website') || rest.customData.hasOwnProperty('siteName')) {
                    rest['trackingId'] = rest.customData.context_website || rest.customData.siteName;
                }
            }
            return rest;
        };
        CoveoAnalyticsClient.prototype.limit = function (input, length) {
            return typeof input === 'string' ? truncateUrl(input, length) : input;
        };
        Object.defineProperty(CoveoAnalyticsClient.prototype, "baseUrl", {
            get: function () {
                return buildBaseUrl(this.options.endpoint, this.options.version, this.options.isCustomEndpoint);
            },
            enumerable: false,
            configurable: true
        });
        return CoveoAnalyticsClient;
    }());

    var analytics$1 = /*#__PURE__*/Object.freeze({
        __proto__: null,
        CoveoAnalyticsClient: CoveoAnalyticsClient,
        Endpoints: Endpoints,
        Version: Version,
        buildBaseUrl: buildBaseUrl,
        default: CoveoAnalyticsClient
    });

    var ECPluginEventTypes = __assign({}, BasePluginEventTypes);
    var allECEventTypes = Object.keys(ECPluginEventTypes).map(function (key) { return ECPluginEventTypes[key]; });
    var ECPlugin = (function (_super) {
        __extends(ECPlugin, _super);
        function ECPlugin(_a) {
            var client = _a.client, _b = _a.uuidGenerator, uuidGenerator = _b === void 0 ? v4 : _b;
            var _this = _super.call(this, { client: client, uuidGenerator: uuidGenerator }) || this;
            _this.products = [];
            _this.impressions = [];
            return _this;
        }
        ECPlugin.prototype.getApi = function (name) {
            var superCall = _super.prototype.getApi.call(this, name);
            if (superCall !== null)
                return superCall;
            switch (name) {
                case 'addProduct':
                    return this.addProduct;
                case 'addImpression':
                    return this.addImpression;
                default:
                    return null;
            }
        };
        ECPlugin.prototype.addHooks = function () {
            this.addHooksForPageView();
            this.addHooksForEvent();
            this.addHooksForECEvents();
        };
        ECPlugin.prototype.addProduct = function (product) {
            this.products.push(product);
        };
        ECPlugin.prototype.addImpression = function (impression) {
            this.impressions.push(impression);
        };
        ECPlugin.prototype.clearPluginData = function () {
            this.products = [];
            this.impressions = [];
        };
        ECPlugin.prototype.addHooksForECEvents = function () {
            var _this = this;
            this.client.registerBeforeSendEventHook(function (eventType) {
                var _a = [];
                for (var _i = 1; _i < arguments.length; _i++) {
                    _a[_i - 1] = arguments[_i];
                }
                var payload = _a[0];
                return allECEventTypes.indexOf(eventType) !== -1 ? _this.addECDataToPayload(eventType, payload) : payload;
            });
            this.client.registerAfterSendEventHook(function (eventType) {
                var _a = [];
                for (var _i = 1; _i < arguments.length; _i++) {
                    _a[_i - 1] = arguments[_i];
                }
                var payload = _a[0];
                if (allECEventTypes.indexOf(eventType) !== -1) {
                    _this.updateLocationInformation(eventType, payload);
                }
                return payload;
            });
        };
        ECPlugin.prototype.addHooksForPageView = function () {
            this.client.addEventTypeMapping(ECPluginEventTypes.pageview, {
                newEventType: EventType.collect,
                variableLengthArgumentsNames: ['page'],
                addVisitorIdParameter: true,
                usesMeasurementProtocol: true,
            });
        };
        ECPlugin.prototype.addHooksForEvent = function () {
            this.client.addEventTypeMapping(ECPluginEventTypes.event, {
                newEventType: EventType.collect,
                variableLengthArgumentsNames: ['eventCategory', 'eventAction', 'eventLabel', 'eventValue'],
                addVisitorIdParameter: true,
                usesMeasurementProtocol: true,
            });
        };
        ECPlugin.prototype.addECDataToPayload = function (eventType, payload) {
            var ecPayload = __assign(__assign(__assign(__assign({}, this.getLocationInformation(eventType, payload)), this.getDefaultContextInformation(eventType)), (this.action ? { action: this.action } : {})), (this.actionData || {}));
            var productPayload = this.getProductPayload();
            var impressionPayload = this.getImpressionPayload();
            this.clearData();
            return __assign(__assign(__assign(__assign({}, impressionPayload), productPayload), ecPayload), payload);
        };
        ECPlugin.prototype.getProductPayload = function () {
            var _this = this;
            return this.products
                .map(function (product) { return _this.assureProductValidity(product); })
                .reduce(function (newPayload, product, index) {
                return __assign(__assign({}, newPayload), convertProductToMeasurementProtocol(_this.convertNumberTypes(product), index));
            }, {});
        };
        ECPlugin.prototype.convertNumberTypes = function (product) {
            var updatedProduct = __assign({}, product);
            if ('quantity' in updatedProduct) {
                updatedProduct.quantity = coerceToNumber(updatedProduct.quantity);
            }
            if ('position' in updatedProduct) {
                updatedProduct.position = coerceToNumber(updatedProduct.position);
            }
            return updatedProduct;
        };
        ECPlugin.prototype.getImpressionPayload = function () {
            var _this = this;
            var impressionsByList = this.getImpressionsByList();
            return impressionsByList
                .map(function (_a) {
                var impressions = _a.impressions, rest = __rest(_a, ["impressions"]);
                return (__assign(__assign({}, rest), { impressions: impressions.map(function (baseImpression) {
                        return _this.assureBaseImpressionValidity(baseImpression);
                    }) }));
            })
                .reduce(function (newPayload, impressionList, index) {
                return __assign(__assign({}, newPayload), convertImpressionListToMeasurementProtocol(impressionList, index, 'pi'));
            }, {});
        };
        ECPlugin.prototype.assureProductValidity = function (product) {
            var position = product.position, productRest = __rest(product, ["position"]);
            if (position !== undefined && position < 1) {
                console.warn("The position for product '".concat(product.name || product.id, "' must be greater ") + "than 0 when provided.");
                return productRest;
            }
            return product;
        };
        ECPlugin.prototype.assureBaseImpressionValidity = function (baseImpression) {
            var position = baseImpression.position, baseImpressionRest = __rest(baseImpression, ["position"]);
            if (position !== undefined && position < 1) {
                console.warn("The position for impression '".concat(baseImpression.name || baseImpression.id, "'") +
                    " must be greater than 0 when provided.");
                return baseImpressionRest;
            }
            return baseImpression;
        };
        ECPlugin.prototype.getImpressionsByList = function () {
            return this.impressions.reduce(function (lists, impression) {
                var listName = impression.list, baseImpression = __rest(impression, ["list"]);
                var list = lists.find(function (list) { return list.listName === listName; });
                if (list) {
                    list.impressions.push(baseImpression);
                }
                else {
                    lists.push({ listName: listName, impressions: [baseImpression] });
                }
                return lists;
            }, []);
        };
        ECPlugin.Id = 'ec';
        return ECPlugin;
    }(BasePlugin));
    var EC = ECPlugin;

    var SVCPluginEventTypes = __assign({}, BasePluginEventTypes);
    var allSVCEventTypes = Object.keys(SVCPluginEventTypes).map(function (key) { return SVCPluginEventTypes[key]; });
    var SVCPlugin = (function (_super) {
        __extends(SVCPlugin, _super);
        function SVCPlugin(_a) {
            var client = _a.client, _b = _a.uuidGenerator, uuidGenerator = _b === void 0 ? v4 : _b;
            var _this = _super.call(this, { client: client, uuidGenerator: uuidGenerator }) || this;
            _this.ticket = {};
            return _this;
        }
        SVCPlugin.prototype.getApi = function (name) {
            var superCall = _super.prototype.getApi.call(this, name);
            if (superCall !== null)
                return superCall;
            switch (name) {
                case 'setTicket':
                    return this.setTicket;
                default:
                    return null;
            }
        };
        SVCPlugin.prototype.addHooks = function () {
            this.addHooksForEvent();
            this.addHooksForPageView();
            this.addHooksForSVCEvents();
        };
        SVCPlugin.prototype.setTicket = function (ticket) {
            this.ticket = ticket;
        };
        SVCPlugin.prototype.clearPluginData = function () {
            this.ticket = {};
        };
        SVCPlugin.prototype.addHooksForSVCEvents = function () {
            var _this = this;
            this.client.registerBeforeSendEventHook(function (eventType) {
                var _a = [];
                for (var _i = 1; _i < arguments.length; _i++) {
                    _a[_i - 1] = arguments[_i];
                }
                var payload = _a[0];
                return allSVCEventTypes.indexOf(eventType) !== -1 ? _this.addSVCDataToPayload(eventType, payload) : payload;
            });
            this.client.registerAfterSendEventHook(function (eventType) {
                var _a = [];
                for (var _i = 1; _i < arguments.length; _i++) {
                    _a[_i - 1] = arguments[_i];
                }
                var payload = _a[0];
                if (allSVCEventTypes.indexOf(eventType) !== -1) {
                    _this.updateLocationInformation(eventType, payload);
                }
                return payload;
            });
        };
        SVCPlugin.prototype.addHooksForPageView = function () {
            this.client.addEventTypeMapping(SVCPluginEventTypes.pageview, {
                newEventType: EventType.collect,
                variableLengthArgumentsNames: ['page'],
                addVisitorIdParameter: true,
                usesMeasurementProtocol: true,
            });
        };
        SVCPlugin.prototype.addHooksForEvent = function () {
            this.client.addEventTypeMapping(SVCPluginEventTypes.event, {
                newEventType: EventType.collect,
                variableLengthArgumentsNames: ['eventCategory', 'eventAction', 'eventLabel', 'eventValue'],
                addVisitorIdParameter: true,
                usesMeasurementProtocol: true,
            });
        };
        SVCPlugin.prototype.addSVCDataToPayload = function (eventType, payload) {
            var _a;
            var svcPayload = __assign(__assign(__assign(__assign({}, this.getLocationInformation(eventType, payload)), this.getDefaultContextInformation(eventType)), (this.action ? { svcAction: this.action } : {})), (Object.keys((_a = this.actionData) !== null && _a !== void 0 ? _a : {}).length > 0 ? { svcActionData: this.actionData } : {}));
            var ticketPayload = this.getTicketPayload();
            this.clearData();
            return __assign(__assign(__assign({}, ticketPayload), svcPayload), payload);
        };
        SVCPlugin.prototype.getTicketPayload = function () {
            return convertTicketToMeasurementProtocol(this.ticket);
        };
        SVCPlugin.Id = 'svc';
        return SVCPlugin;
    }(BasePlugin));
    var SVC = SVCPlugin;

    var Plugins = (function () {
        function Plugins() {
            var _a;
            this.registeredPluginsMap = (_a = {},
                _a[EC.Id] = EC,
                _a[SVC.Id] = SVC,
                _a[Link.Id] = Link,
                _a);
            this.requiredPlugins = {};
        }
        Plugins.prototype.require = function (name, options) {
            var pluginClass = this.registeredPluginsMap[name];
            if (!pluginClass) {
                throw new Error("No plugin named \"".concat(name, "\" is currently registered. If you use a custom plugin, use 'provide' first."));
            }
            this.requiredPlugins[name] = new pluginClass(options);
        };
        Plugins.prototype.provide = function (name, plugin) {
            this.registeredPluginsMap[name] = plugin;
        };
        Plugins.prototype.clearRequired = function () {
            this.requiredPlugins = {};
        };
        Plugins.prototype.execute = function (name, fn) {
            var args = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                args[_i - 2] = arguments[_i];
            }
            var plugin = this.requiredPlugins[name];
            if (!plugin) {
                throw new Error("The plugin \"".concat(name, "\" is not required. Check that you required it on initialization."));
            }
            var actionFunction = plugin.getApi(fn);
            if (!actionFunction) {
                throw new Error("The function \"".concat(fn, "\" does not exist on the plugin \"").concat(name, "\"."));
            }
            if (typeof actionFunction !== 'function') {
                throw new Error("\"".concat(fn, "\" of the plugin \"").concat(name, "\" is not a function."));
            }
            return actionFunction.apply(plugin, args);
        };
        Plugins.DefaultPlugins = [EC.Id, SVC.Id, Link.Id];
        return Plugins;
    }());

    var CoveoUA = (function () {
        function CoveoUA() {
            this.plugins = new Plugins();
            this.params = {};
        }
        CoveoUA.prototype.init = function (token, optionsOrEndpoint) {
            var _this = this;
            if (!token) {
                throw new Error("You must pass your token when you call 'init'");
            }
            if (typeof token === 'string') {
                this.client = new CoveoAnalyticsClient({
                    token: token,
                    endpoint: this.getEndpoint(optionsOrEndpoint),
                    isCustomEndpoint: this.getIsCustomEndpoint(optionsOrEndpoint),
                });
            }
            else if (this.isAnalyticsClient(token)) {
                this.client = token;
            }
            if (this.client) {
                var pluginOptions_1 = { client: this.client };
                this.plugins.clearRequired();
                this.getPluginKeys(optionsOrEndpoint).forEach(function (pluginKey) {
                    return _this.plugins.require(pluginKey, pluginOptions_1);
                });
                this.client.registerBeforeSendEventHook(function (eventType, payload) { return (__assign(__assign({}, payload), _this.params)); });
            }
            else {
                throw new Error("You must pass either your token or a valid object when you call 'init'");
            }
        };
        CoveoUA.prototype.isAnalyticsClient = function (token) {
            return typeof token === 'object' && typeof token.sendEvent !== 'undefined';
        };
        CoveoUA.prototype.getPluginKeys = function (optionsOrEndpoint) {
            if (typeof optionsOrEndpoint === 'string') {
                return Plugins.DefaultPlugins;
            }
            return Array.isArray(optionsOrEndpoint === null || optionsOrEndpoint === void 0 ? void 0 : optionsOrEndpoint.plugins) ? optionsOrEndpoint.plugins : Plugins.DefaultPlugins;
        };
        CoveoUA.prototype.getEndpoint = function (optionsOrEndpoint) {
            if (typeof optionsOrEndpoint === 'string') {
                return optionsOrEndpoint || Endpoints.default;
            }
            else if (optionsOrEndpoint === null || optionsOrEndpoint === void 0 ? void 0 : optionsOrEndpoint.endpoint) {
                return optionsOrEndpoint.endpoint;
            }
            return Endpoints.default;
        };
        CoveoUA.prototype.getIsCustomEndpoint = function (optionsOrEndpoint) {
            if (typeof optionsOrEndpoint === 'string') {
                return false;
            }
            else if (optionsOrEndpoint === null || optionsOrEndpoint === void 0 ? void 0 : optionsOrEndpoint.isCustomEndpoint) {
                return optionsOrEndpoint.isCustomEndpoint;
            }
            return false;
        };
        CoveoUA.prototype.initForProxy = function (endpoint, isCustomEndpoint) {
            if (isCustomEndpoint === void 0) { isCustomEndpoint = false; }
            if (!endpoint) {
                throw new Error("You must pass your endpoint when you call 'initForProxy'");
            }
            if (typeof endpoint !== 'string') {
                throw new Error("You must pass a string as the endpoint parameter when you call 'initForProxy'");
            }
            this.client = new CoveoAnalyticsClient({
                endpoint: endpoint,
                isCustomEndpoint: isCustomEndpoint,
            });
        };
        CoveoUA.prototype.set = function (keyOrObject, value) {
            var _this = this;
            if (typeof keyOrObject === 'string') {
                this.params[keyOrObject] = value;
            }
            else {
                Object.keys(keyOrObject).map(function (key) {
                    _this.params[key] = keyOrObject[key];
                });
            }
        };
        CoveoUA.prototype.send = function () {
            var _a;
            var _b = [];
            for (var _i = 0; _i < arguments.length; _i++) {
                _b[_i] = arguments[_i];
            }
            var event = _b[0], payload = _b.slice(1);
            if (typeof this.client == 'undefined') {
                throw new Error("You must call init before sending an event");
            }
            if (!event) {
                throw new Error("You must provide an event type when calling \"send\".");
            }
            return (_a = this.client).sendEvent.apply(_a, __spreadArray([event.toLowerCase()], payload, false));
        };
        CoveoUA.prototype.onLoad = function (callback) {
            if (typeof callback == 'undefined') {
                throw new Error("You must pass a function when you call 'onLoad'");
            }
            callback();
        };
        CoveoUA.prototype.provide = function (name, plugin) {
            this.plugins.provide(name, plugin);
        };
        CoveoUA.prototype.require = function (name, options) {
            if (!this.client) {
                throw new Error("You must call init before requiring a plugin");
            }
            this.plugins.require(name, __assign(__assign({}, options), { client: this.client }));
        };
        CoveoUA.prototype.callPlugin = function (pluginName, fn) {
            var _a;
            var args = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                args[_i - 2] = arguments[_i];
            }
            if (!this.client) {
                throw new Error("You must call init before calling a plugin function");
            }
            return (_a = this.plugins).execute.apply(_a, __spreadArray([pluginName, fn], args, false));
        };
        CoveoUA.prototype.reset = function () {
            this.client = undefined;
            this.plugins = new Plugins();
            this.params = {};
        };
        CoveoUA.prototype.version = function () {
            return libVersion;
        };
        return CoveoUA;
    }());
    var coveoua$1 = new CoveoUA();
    var getCurrentClient = function () { return coveoua$1.client; };
    var handleOneAnalyticsEvent = function (command) {
        var params = [];
        for (var _i = 1; _i < arguments.length; _i++) {
            params[_i - 1] = arguments[_i];
        }
        var _a = /^(?:(\w+)\.)?(?:(\w+):)?(\w+)$/.exec(command); _a[1]; var pluginName = _a[2], fn = _a[3];
        var actionFunction = coveoua$1[fn];
        if (pluginName && fn) {
            return coveoua$1.callPlugin.apply(coveoua$1, __spreadArray([pluginName, fn], params, false));
        }
        else if (actionFunction) {
            return actionFunction.apply(coveoua$1, params);
        }
        else {
            var actions = [
                'init',
                'set',
                'send',
                'onLoad',
                'callPlugin',
                'reset',
                'require',
                'provide',
                'version',
            ];
            throw new Error("The action \"".concat(command, "\" does not exist. Available actions: ").concat(actions.join(', '), "."));
        }
    };

    var simpleanalytics = /*#__PURE__*/Object.freeze({
        __proto__: null,
        CoveoUA: CoveoUA,
        coveoua: coveoua$1,
        default: handleOneAnalyticsEvent,
        getCurrentClient: getCurrentClient,
        handleOneAnalyticsEvent: handleOneAnalyticsEvent
    });

    var InsightEvents;
    (function (InsightEvents) {
        InsightEvents["contextChanged"] = "contextChanged";
        InsightEvents["expandToFullUI"] = "expandToFullUI";
        InsightEvents["openUserActions"] = "openUserActions";
        InsightEvents["showPrecedingSessions"] = "showPrecedingSessions";
        InsightEvents["showFollowingSessions"] = "showFollowingSessions";
        InsightEvents["clickViewedDocument"] = "clickViewedDocument";
        InsightEvents["clickPageView"] = "clickPageView";
        InsightEvents["createArticle"] = "createArticle";
    })(InsightEvents || (InsightEvents = {}));

    var _a;
    var SearchPageEvents;
    (function (SearchPageEvents) {
        SearchPageEvents["interfaceLoad"] = "interfaceLoad";
        SearchPageEvents["interfaceChange"] = "interfaceChange";
        SearchPageEvents["didyoumeanAutomatic"] = "didyoumeanAutomatic";
        SearchPageEvents["didyoumeanClick"] = "didyoumeanClick";
        SearchPageEvents["resultsSort"] = "resultsSort";
        SearchPageEvents["searchboxSubmit"] = "searchboxSubmit";
        SearchPageEvents["searchboxClear"] = "searchboxClear";
        SearchPageEvents["searchboxAsYouType"] = "searchboxAsYouType";
        SearchPageEvents["breadcrumbFacet"] = "breadcrumbFacet";
        SearchPageEvents["breadcrumbResetAll"] = "breadcrumbResetAll";
        SearchPageEvents["documentQuickview"] = "documentQuickview";
        SearchPageEvents["documentOpen"] = "documentOpen";
        SearchPageEvents["omniboxAnalytics"] = "omniboxAnalytics";
        SearchPageEvents["omniboxFromLink"] = "omniboxFromLink";
        SearchPageEvents["searchFromLink"] = "searchFromLink";
        SearchPageEvents["triggerNotify"] = "notify";
        SearchPageEvents["triggerExecute"] = "execute";
        SearchPageEvents["triggerQuery"] = "query";
        SearchPageEvents["undoTriggerQuery"] = "undoQuery";
        SearchPageEvents["triggerRedirect"] = "redirect";
        SearchPageEvents["pagerResize"] = "pagerResize";
        SearchPageEvents["pagerNumber"] = "pagerNumber";
        SearchPageEvents["pagerNext"] = "pagerNext";
        SearchPageEvents["pagerPrevious"] = "pagerPrevious";
        SearchPageEvents["pagerScrolling"] = "pagerScrolling";
        SearchPageEvents["staticFilterClearAll"] = "staticFilterClearAll";
        SearchPageEvents["staticFilterSelect"] = "staticFilterSelect";
        SearchPageEvents["staticFilterDeselect"] = "staticFilterDeselect";
        SearchPageEvents["facetClearAll"] = "facetClearAll";
        SearchPageEvents["facetSearch"] = "facetSearch";
        SearchPageEvents["facetSelect"] = "facetSelect";
        SearchPageEvents["facetSelectAll"] = "facetSelectAll";
        SearchPageEvents["facetDeselect"] = "facetDeselect";
        SearchPageEvents["facetExclude"] = "facetExclude";
        SearchPageEvents["facetUnexclude"] = "facetUnexclude";
        SearchPageEvents["facetUpdateSort"] = "facetUpdateSort";
        SearchPageEvents["facetShowMore"] = "showMoreFacetResults";
        SearchPageEvents["facetShowLess"] = "showLessFacetResults";
        SearchPageEvents["queryError"] = "query";
        SearchPageEvents["queryErrorBack"] = "errorBack";
        SearchPageEvents["queryErrorClear"] = "errorClearQuery";
        SearchPageEvents["queryErrorRetry"] = "errorRetry";
        SearchPageEvents["recommendation"] = "recommendation";
        SearchPageEvents["recommendationInterfaceLoad"] = "recommendationInterfaceLoad";
        SearchPageEvents["recommendationOpen"] = "recommendationOpen";
        SearchPageEvents["likeSmartSnippet"] = "likeSmartSnippet";
        SearchPageEvents["dislikeSmartSnippet"] = "dislikeSmartSnippet";
        SearchPageEvents["expandSmartSnippet"] = "expandSmartSnippet";
        SearchPageEvents["collapseSmartSnippet"] = "collapseSmartSnippet";
        SearchPageEvents["openSmartSnippetFeedbackModal"] = "openSmartSnippetFeedbackModal";
        SearchPageEvents["closeSmartSnippetFeedbackModal"] = "closeSmartSnippetFeedbackModal";
        SearchPageEvents["sendSmartSnippetReason"] = "sendSmartSnippetReason";
        SearchPageEvents["expandSmartSnippetSuggestion"] = "expandSmartSnippetSuggestion";
        SearchPageEvents["collapseSmartSnippetSuggestion"] = "collapseSmartSnippetSuggestion";
        SearchPageEvents["showMoreSmartSnippetSuggestion"] = "showMoreSmartSnippetSuggestion";
        SearchPageEvents["showLessSmartSnippetSuggestion"] = "showLessSmartSnippetSuggestion";
        SearchPageEvents["openSmartSnippetSource"] = "openSmartSnippetSource";
        SearchPageEvents["openSmartSnippetSuggestionSource"] = "openSmartSnippetSuggestionSource";
        SearchPageEvents["openSmartSnippetInlineLink"] = "openSmartSnippetInlineLink";
        SearchPageEvents["openSmartSnippetSuggestionInlineLink"] = "openSmartSnippetSuggestionInlineLink";
        SearchPageEvents["recentQueryClick"] = "recentQueriesClick";
        SearchPageEvents["clearRecentQueries"] = "clearRecentQueries";
        SearchPageEvents["recentResultClick"] = "recentResultClick";
        SearchPageEvents["clearRecentResults"] = "clearRecentResults";
        SearchPageEvents["noResultsBack"] = "noResultsBack";
        SearchPageEvents["showMoreFoldedResults"] = "showMoreFoldedResults";
        SearchPageEvents["showLessFoldedResults"] = "showLessFoldedResults";
        SearchPageEvents["copyToClipboard"] = "copyToClipboard";
        SearchPageEvents["caseSendEmail"] = "Case.SendEmail";
        SearchPageEvents["feedItemTextPost"] = "FeedItem.TextPost";
        SearchPageEvents["caseAttach"] = "caseAttach";
        SearchPageEvents["caseDetach"] = "caseDetach";
        SearchPageEvents["retryGeneratedAnswer"] = "retryGeneratedAnswer";
        SearchPageEvents["likeGeneratedAnswer"] = "likeGeneratedAnswer";
        SearchPageEvents["dislikeGeneratedAnswer"] = "dislikeGeneratedAnswer";
        SearchPageEvents["openGeneratedAnswerSource"] = "openGeneratedAnswerSource";
        SearchPageEvents["generatedAnswerStreamEnd"] = "generatedAnswerStreamEnd";
        SearchPageEvents["generatedAnswerSourceHover"] = "generatedAnswerSourceHover";
        SearchPageEvents["generatedAnswerCopyToClipboard"] = "generatedAnswerCopyToClipboard";
        SearchPageEvents["generatedAnswerHideAnswers"] = "generatedAnswerHideAnswers";
        SearchPageEvents["generatedAnswerShowAnswers"] = "generatedAnswerShowAnswers";
        SearchPageEvents["generatedAnswerExpand"] = "generatedAnswerExpand";
        SearchPageEvents["generatedAnswerCollapse"] = "generatedAnswerCollapse";
        SearchPageEvents["generatedAnswerFeedbackSubmit"] = "generatedAnswerFeedbackSubmit";
        SearchPageEvents["rephraseGeneratedAnswer"] = "rephraseGeneratedAnswer";
        SearchPageEvents["generatedAnswerFeedbackSubmitV2"] = "generatedAnswerFeedbackSubmitV2";
        SearchPageEvents["generatedAnswerCitationClick"] = "generatedAnswerCitationClick";
        SearchPageEvents["generatedAnswerCitationDocumentAttach"] = "generatedAnswerCitationDocumentAttach";
    })(SearchPageEvents || (SearchPageEvents = {}));
    var CustomEventsTypes = (_a = {},
        _a[SearchPageEvents.triggerNotify] = 'queryPipelineTriggers',
        _a[SearchPageEvents.triggerExecute] = 'queryPipelineTriggers',
        _a[SearchPageEvents.triggerQuery] = 'queryPipelineTriggers',
        _a[SearchPageEvents.triggerRedirect] = 'queryPipelineTriggers',
        _a[SearchPageEvents.queryErrorBack] = 'errors',
        _a[SearchPageEvents.queryErrorClear] = 'errors',
        _a[SearchPageEvents.queryErrorRetry] = 'errors',
        _a[SearchPageEvents.pagerNext] = 'getMoreResults',
        _a[SearchPageEvents.pagerPrevious] = 'getMoreResults',
        _a[SearchPageEvents.pagerNumber] = 'getMoreResults',
        _a[SearchPageEvents.pagerResize] = 'getMoreResults',
        _a[SearchPageEvents.pagerScrolling] = 'getMoreResults',
        _a[SearchPageEvents.facetSearch] = 'facet',
        _a[SearchPageEvents.facetShowLess] = 'facet',
        _a[SearchPageEvents.facetShowMore] = 'facet',
        _a[SearchPageEvents.recommendation] = 'recommendation',
        _a[SearchPageEvents.likeSmartSnippet] = 'smartSnippet',
        _a[SearchPageEvents.dislikeSmartSnippet] = 'smartSnippet',
        _a[SearchPageEvents.expandSmartSnippet] = 'smartSnippet',
        _a[SearchPageEvents.collapseSmartSnippet] = 'smartSnippet',
        _a[SearchPageEvents.openSmartSnippetFeedbackModal] = 'smartSnippet',
        _a[SearchPageEvents.closeSmartSnippetFeedbackModal] = 'smartSnippet',
        _a[SearchPageEvents.sendSmartSnippetReason] = 'smartSnippet',
        _a[SearchPageEvents.expandSmartSnippetSuggestion] = 'smartSnippetSuggestions',
        _a[SearchPageEvents.collapseSmartSnippetSuggestion] = 'smartSnippetSuggestions',
        _a[SearchPageEvents.showMoreSmartSnippetSuggestion] = 'smartSnippetSuggestions',
        _a[SearchPageEvents.showLessSmartSnippetSuggestion] = 'smartSnippetSuggestions',
        _a[SearchPageEvents.clearRecentQueries] = 'recentQueries',
        _a[SearchPageEvents.recentResultClick] = 'recentlyClickedDocuments',
        _a[SearchPageEvents.clearRecentResults] = 'recentlyClickedDocuments',
        _a[SearchPageEvents.showLessFoldedResults] = 'folding',
        _a[SearchPageEvents.caseDetach] = 'case',
        _a[SearchPageEvents.likeGeneratedAnswer] = 'generatedAnswer',
        _a[SearchPageEvents.dislikeGeneratedAnswer] = 'generatedAnswer',
        _a[SearchPageEvents.openGeneratedAnswerSource] = 'generatedAnswer',
        _a[SearchPageEvents.generatedAnswerStreamEnd] = 'generatedAnswer',
        _a[SearchPageEvents.generatedAnswerSourceHover] = 'generatedAnswer',
        _a[SearchPageEvents.generatedAnswerCopyToClipboard] = 'generatedAnswer',
        _a[SearchPageEvents.generatedAnswerHideAnswers] = 'generatedAnswer',
        _a[SearchPageEvents.generatedAnswerShowAnswers] = 'generatedAnswer',
        _a[SearchPageEvents.generatedAnswerExpand] = 'generatedAnswer',
        _a[SearchPageEvents.generatedAnswerCollapse] = 'generatedAnswer',
        _a[SearchPageEvents.generatedAnswerFeedbackSubmit] = 'generatedAnswer',
        _a[SearchPageEvents.generatedAnswerFeedbackSubmitV2] = 'generatedAnswer',
        _a[InsightEvents.expandToFullUI] = 'interface',
        _a[InsightEvents.openUserActions] = 'User Actions',
        _a[InsightEvents.showPrecedingSessions] = 'User Actions',
        _a[InsightEvents.showFollowingSessions] = 'User Actions',
        _a[InsightEvents.clickViewedDocument] = 'User Actions',
        _a[InsightEvents.clickPageView] = 'User Actions',
        _a[InsightEvents.createArticle] = 'createArticle',
        _a);

    var NoopAnalytics = (function () {
        function NoopAnalytics() {
            this.runtime = new NoopRuntime();
            this.currentVisitorId = '';
        }
        NoopAnalytics.prototype.getPayload = function () {
            return Promise.resolve();
        };
        NoopAnalytics.prototype.getParameters = function () {
            return Promise.resolve();
        };
        NoopAnalytics.prototype.makeEvent = function (eventType) {
            return Promise.resolve({ eventType: eventType, payload: null, log: function () { return Promise.resolve(); } });
        };
        NoopAnalytics.prototype.sendEvent = function () {
            return Promise.resolve();
        };
        NoopAnalytics.prototype.makeSearchEvent = function () {
            return this.makeEvent(EventType.search);
        };
        NoopAnalytics.prototype.sendSearchEvent = function () {
            return Promise.resolve();
        };
        NoopAnalytics.prototype.makeClickEvent = function () {
            return this.makeEvent(EventType.click);
        };
        NoopAnalytics.prototype.sendClickEvent = function () {
            return Promise.resolve();
        };
        NoopAnalytics.prototype.makeCustomEvent = function () {
            return this.makeEvent(EventType.custom);
        };
        NoopAnalytics.prototype.sendCustomEvent = function () {
            return Promise.resolve();
        };
        NoopAnalytics.prototype.makeViewEvent = function () {
            return this.makeEvent(EventType.view);
        };
        NoopAnalytics.prototype.sendViewEvent = function () {
            return Promise.resolve();
        };
        NoopAnalytics.prototype.getVisit = function () {
            return Promise.resolve({ id: '', visitorId: '' });
        };
        NoopAnalytics.prototype.getHealth = function () {
            return Promise.resolve({ status: '' });
        };
        NoopAnalytics.prototype.registerBeforeSendEventHook = function () { };
        NoopAnalytics.prototype.registerAfterSendEventHook = function () { };
        NoopAnalytics.prototype.addEventTypeMapping = function () { };
        Object.defineProperty(NoopAnalytics.prototype, "version", {
            get: function () {
                return libVersion;
            },
            enumerable: false,
            configurable: true
        });
        return NoopAnalytics;
    }());

    function filterConsecutiveRepeatedValues(rawData) {
        var prev = '';
        return rawData.filter(function (value) {
            var isDifferent = value !== prev;
            prev = value;
            return isDifferent;
        });
    }
    function removeSemicolons(rawData) {
        return rawData.map(function (value) {
            return value.replace(/;/g, '');
        });
    }
    function getDataString(data) {
        var ANALYTICS_LENGTH_LIMIT = 256;
        var formattedData = data.join(';');
        if (formattedData.length <= ANALYTICS_LENGTH_LIMIT) {
            return formattedData;
        }
        return getDataString(data.slice(1));
    }
    var formatArrayForCoveoCustomData = function (rawData) {
        var dataWithoutSemicolons = removeSemicolons(rawData);
        var dataWithoutRepeatedValues = filterConsecutiveRepeatedValues(dataWithoutSemicolons);
        return getDataString(dataWithoutRepeatedValues);
    };

    function formatOmniboxMetadata(meta) {
        var partialQueries = typeof meta.partialQueries === 'string'
            ? meta.partialQueries
            : formatArrayForCoveoCustomData(meta.partialQueries);
        var suggestions = typeof meta.suggestions === 'string' ? meta.suggestions : formatArrayForCoveoCustomData(meta.suggestions);
        return __assign(__assign({}, meta), { partialQueries: partialQueries, suggestions: suggestions });
    }

    var CoveoSearchPageClient = (function () {
        function CoveoSearchPageClient(opts, provider) {
            this.opts = opts;
            this.provider = provider;
            var shouldDisableAnalytics = opts.enableAnalytics === false || doNotTrack();
            this.coveoAnalyticsClient = shouldDisableAnalytics ? new NoopAnalytics() : new CoveoAnalyticsClient(opts);
        }
        CoveoSearchPageClient.prototype.disable = function () {
            this.coveoAnalyticsClient = new NoopAnalytics();
        };
        CoveoSearchPageClient.prototype.enable = function () {
            this.coveoAnalyticsClient = new CoveoAnalyticsClient(this.opts);
        };
        CoveoSearchPageClient.prototype.makeInterfaceLoad = function () {
            return this.makeSearchEvent(SearchPageEvents.interfaceLoad);
        };
        CoveoSearchPageClient.prototype.logInterfaceLoad = function () {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeInterfaceLoad()];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeRecommendationInterfaceLoad = function () {
            return this.makeSearchEvent(SearchPageEvents.recommendationInterfaceLoad);
        };
        CoveoSearchPageClient.prototype.logRecommendationInterfaceLoad = function () {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeRecommendationInterfaceLoad()];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeRecommendation = function () {
            return this.makeCustomEvent(SearchPageEvents.recommendation);
        };
        CoveoSearchPageClient.prototype.logRecommendation = function () {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeRecommendation()];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeRecommendationOpen = function (info, identifier) {
            return this.makeClickEvent(SearchPageEvents.recommendationOpen, info, identifier);
        };
        CoveoSearchPageClient.prototype.logRecommendationOpen = function (info, identifier) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeRecommendationOpen(info, identifier)];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeStaticFilterClearAll = function (meta) {
            return this.makeSearchEvent(SearchPageEvents.staticFilterClearAll, meta);
        };
        CoveoSearchPageClient.prototype.logStaticFilterClearAll = function (meta) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeStaticFilterClearAll(meta)];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeStaticFilterSelect = function (meta) {
            return this.makeSearchEvent(SearchPageEvents.staticFilterSelect, meta);
        };
        CoveoSearchPageClient.prototype.logStaticFilterSelect = function (meta) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeStaticFilterSelect(meta)];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeStaticFilterDeselect = function (meta) {
            return this.makeSearchEvent(SearchPageEvents.staticFilterDeselect, meta);
        };
        CoveoSearchPageClient.prototype.logStaticFilterDeselect = function (meta) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeStaticFilterDeselect(meta)];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeFetchMoreResults = function () {
            return this.makeCustomEvent(SearchPageEvents.pagerScrolling, { type: 'getMoreResults' });
        };
        CoveoSearchPageClient.prototype.logFetchMoreResults = function () {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeFetchMoreResults()];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeInterfaceChange = function (metadata) {
            return this.makeSearchEvent(SearchPageEvents.interfaceChange, metadata);
        };
        CoveoSearchPageClient.prototype.logInterfaceChange = function (metadata) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeInterfaceChange(metadata)];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeDidYouMeanAutomatic = function () {
            return this.makeSearchEvent(SearchPageEvents.didyoumeanAutomatic);
        };
        CoveoSearchPageClient.prototype.logDidYouMeanAutomatic = function () {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeDidYouMeanAutomatic()];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeDidYouMeanClick = function () {
            return this.makeSearchEvent(SearchPageEvents.didyoumeanClick);
        };
        CoveoSearchPageClient.prototype.logDidYouMeanClick = function () {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeDidYouMeanClick()];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeResultsSort = function (metadata) {
            return this.makeSearchEvent(SearchPageEvents.resultsSort, metadata);
        };
        CoveoSearchPageClient.prototype.logResultsSort = function (metadata) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeResultsSort(metadata)];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeSearchboxSubmit = function () {
            return this.makeSearchEvent(SearchPageEvents.searchboxSubmit);
        };
        CoveoSearchPageClient.prototype.logSearchboxSubmit = function () {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeSearchboxSubmit()];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeSearchboxClear = function () {
            return this.makeSearchEvent(SearchPageEvents.searchboxClear);
        };
        CoveoSearchPageClient.prototype.logSearchboxClear = function () {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeSearchboxClear()];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeSearchboxAsYouType = function () {
            return this.makeSearchEvent(SearchPageEvents.searchboxAsYouType);
        };
        CoveoSearchPageClient.prototype.logSearchboxAsYouType = function () {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeSearchboxAsYouType()];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeBreadcrumbFacet = function (metadata) {
            return this.makeSearchEvent(SearchPageEvents.breadcrumbFacet, metadata);
        };
        CoveoSearchPageClient.prototype.logBreadcrumbFacet = function (metadata) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeBreadcrumbFacet(metadata)];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeBreadcrumbResetAll = function () {
            return this.makeSearchEvent(SearchPageEvents.breadcrumbResetAll);
        };
        CoveoSearchPageClient.prototype.logBreadcrumbResetAll = function () {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeBreadcrumbResetAll()];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeDocumentQuickview = function (info, identifier) {
            return this.makeClickEvent(SearchPageEvents.documentQuickview, info, identifier);
        };
        CoveoSearchPageClient.prototype.logDocumentQuickview = function (info, identifier) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeDocumentQuickview(info, identifier)];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeDocumentOpen = function (info, identifier) {
            return this.makeClickEvent(SearchPageEvents.documentOpen, info, identifier);
        };
        CoveoSearchPageClient.prototype.logDocumentOpen = function (info, identifier) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeDocumentOpen(info, identifier)];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeOmniboxAnalytics = function (meta) {
            return this.makeSearchEvent(SearchPageEvents.omniboxAnalytics, formatOmniboxMetadata(meta));
        };
        CoveoSearchPageClient.prototype.logOmniboxAnalytics = function (meta) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeOmniboxAnalytics(meta)];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeOmniboxFromLink = function (meta) {
            return this.makeSearchEvent(SearchPageEvents.omniboxFromLink, formatOmniboxMetadata(meta));
        };
        CoveoSearchPageClient.prototype.logOmniboxFromLink = function (meta) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeOmniboxFromLink(meta)];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeSearchFromLink = function () {
            return this.makeSearchEvent(SearchPageEvents.searchFromLink);
        };
        CoveoSearchPageClient.prototype.logSearchFromLink = function () {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeSearchFromLink()];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeTriggerNotify = function (meta) {
            return this.makeCustomEvent(SearchPageEvents.triggerNotify, meta);
        };
        CoveoSearchPageClient.prototype.logTriggerNotify = function (meta) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeTriggerNotify(meta)];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeTriggerExecute = function (meta) {
            return this.makeCustomEvent(SearchPageEvents.triggerExecute, meta);
        };
        CoveoSearchPageClient.prototype.logTriggerExecute = function (meta) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeTriggerExecute(meta)];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeTriggerQuery = function () {
            return this.makeCustomEvent(SearchPageEvents.triggerQuery, { query: this.provider.getSearchEventRequestPayload().queryText }, 'queryPipelineTriggers');
        };
        CoveoSearchPageClient.prototype.logTriggerQuery = function () {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeTriggerQuery()];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeUndoTriggerQuery = function (meta) {
            return this.makeSearchEvent(SearchPageEvents.undoTriggerQuery, meta);
        };
        CoveoSearchPageClient.prototype.logUndoTriggerQuery = function (meta) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeUndoTriggerQuery(meta)];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeTriggerRedirect = function (meta) {
            return this.makeCustomEvent(SearchPageEvents.triggerRedirect, __assign(__assign({}, meta), { query: this.provider.getSearchEventRequestPayload().queryText }));
        };
        CoveoSearchPageClient.prototype.logTriggerRedirect = function (meta) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeTriggerRedirect(meta)];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makePagerResize = function (meta) {
            return this.makeCustomEvent(SearchPageEvents.pagerResize, meta);
        };
        CoveoSearchPageClient.prototype.logPagerResize = function (meta) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makePagerResize(meta)];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makePagerNumber = function (meta) {
            return this.makeCustomEvent(SearchPageEvents.pagerNumber, meta);
        };
        CoveoSearchPageClient.prototype.logPagerNumber = function (meta) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makePagerNumber(meta)];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makePagerNext = function (meta) {
            return this.makeCustomEvent(SearchPageEvents.pagerNext, meta);
        };
        CoveoSearchPageClient.prototype.logPagerNext = function (meta) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makePagerNext(meta)];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makePagerPrevious = function (meta) {
            return this.makeCustomEvent(SearchPageEvents.pagerPrevious, meta);
        };
        CoveoSearchPageClient.prototype.logPagerPrevious = function (meta) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makePagerPrevious(meta)];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makePagerScrolling = function () {
            return this.makeCustomEvent(SearchPageEvents.pagerScrolling);
        };
        CoveoSearchPageClient.prototype.logPagerScrolling = function () {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makePagerScrolling()];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeFacetClearAll = function (meta) {
            return this.makeSearchEvent(SearchPageEvents.facetClearAll, meta);
        };
        CoveoSearchPageClient.prototype.logFacetClearAll = function (meta) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeFacetClearAll(meta)];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeFacetSearch = function (meta) {
            return this.makeSearchEvent(SearchPageEvents.facetSearch, meta);
        };
        CoveoSearchPageClient.prototype.logFacetSearch = function (meta) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeFacetSearch(meta)];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeFacetSelect = function (meta) {
            return this.makeSearchEvent(SearchPageEvents.facetSelect, meta);
        };
        CoveoSearchPageClient.prototype.logFacetSelect = function (meta) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeFacetSelect(meta)];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeFacetDeselect = function (meta) {
            return this.makeSearchEvent(SearchPageEvents.facetDeselect, meta);
        };
        CoveoSearchPageClient.prototype.logFacetDeselect = function (meta) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeFacetDeselect(meta)];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeFacetExclude = function (meta) {
            return this.makeSearchEvent(SearchPageEvents.facetExclude, meta);
        };
        CoveoSearchPageClient.prototype.logFacetExclude = function (meta) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeFacetExclude(meta)];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeFacetUnexclude = function (meta) {
            return this.makeSearchEvent(SearchPageEvents.facetUnexclude, meta);
        };
        CoveoSearchPageClient.prototype.logFacetUnexclude = function (meta) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeFacetUnexclude(meta)];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeFacetSelectAll = function (meta) {
            return this.makeSearchEvent(SearchPageEvents.facetSelectAll, meta);
        };
        CoveoSearchPageClient.prototype.logFacetSelectAll = function (meta) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeFacetSelectAll(meta)];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeFacetUpdateSort = function (meta) {
            return this.makeSearchEvent(SearchPageEvents.facetUpdateSort, meta);
        };
        CoveoSearchPageClient.prototype.logFacetUpdateSort = function (meta) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeFacetUpdateSort(meta)];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeFacetShowMore = function (meta) {
            return this.makeCustomEvent(SearchPageEvents.facetShowMore, meta);
        };
        CoveoSearchPageClient.prototype.logFacetShowMore = function (meta) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeFacetShowMore(meta)];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeFacetShowLess = function (meta) {
            return this.makeCustomEvent(SearchPageEvents.facetShowLess, meta);
        };
        CoveoSearchPageClient.prototype.logFacetShowLess = function (meta) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeFacetShowLess(meta)];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeQueryError = function (meta) {
            return this.makeCustomEvent(SearchPageEvents.queryError, meta);
        };
        CoveoSearchPageClient.prototype.logQueryError = function (meta) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeQueryError(meta)];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeQueryErrorBack = function () {
            return __awaiter(this, void 0, void 0, function () {
                var customEventBuilder;
                var _this = this;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeCustomEvent(SearchPageEvents.queryErrorBack)];
                        case 1:
                            customEventBuilder = _a.sent();
                            return [2, {
                                    description: customEventBuilder.description,
                                    log: function () { return __awaiter(_this, void 0, void 0, function () {
                                        return __generator(this, function (_a) {
                                            switch (_a.label) {
                                                case 0: return [4, customEventBuilder.log({ searchUID: this.provider.getSearchUID() })];
                                                case 1:
                                                    _a.sent();
                                                    return [2, this.logSearchEvent(SearchPageEvents.queryErrorBack)];
                                            }
                                        });
                                    }); },
                                }];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.logQueryErrorBack = function () {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeQueryErrorBack()];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeQueryErrorRetry = function () {
            return __awaiter(this, void 0, void 0, function () {
                var customEventBuilder;
                var _this = this;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeCustomEvent(SearchPageEvents.queryErrorRetry)];
                        case 1:
                            customEventBuilder = _a.sent();
                            return [2, {
                                    description: customEventBuilder.description,
                                    log: function () { return __awaiter(_this, void 0, void 0, function () {
                                        return __generator(this, function (_a) {
                                            switch (_a.label) {
                                                case 0: return [4, customEventBuilder.log({ searchUID: this.provider.getSearchUID() })];
                                                case 1:
                                                    _a.sent();
                                                    return [2, this.logSearchEvent(SearchPageEvents.queryErrorRetry)];
                                            }
                                        });
                                    }); },
                                }];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.logQueryErrorRetry = function () {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeQueryErrorRetry()];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeQueryErrorClear = function () {
            return __awaiter(this, void 0, void 0, function () {
                var customEventBuilder;
                var _this = this;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeCustomEvent(SearchPageEvents.queryErrorClear)];
                        case 1:
                            customEventBuilder = _a.sent();
                            return [2, {
                                    description: customEventBuilder.description,
                                    log: function () { return __awaiter(_this, void 0, void 0, function () {
                                        return __generator(this, function (_a) {
                                            switch (_a.label) {
                                                case 0: return [4, customEventBuilder.log({ searchUID: this.provider.getSearchUID() })];
                                                case 1:
                                                    _a.sent();
                                                    return [2, this.logSearchEvent(SearchPageEvents.queryErrorClear)];
                                            }
                                        });
                                    }); },
                                }];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.logQueryErrorClear = function () {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeQueryErrorClear()];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeLikeSmartSnippet = function () {
            return this.makeCustomEvent(SearchPageEvents.likeSmartSnippet);
        };
        CoveoSearchPageClient.prototype.logLikeSmartSnippet = function () {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeLikeSmartSnippet()];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeDislikeSmartSnippet = function () {
            return this.makeCustomEvent(SearchPageEvents.dislikeSmartSnippet);
        };
        CoveoSearchPageClient.prototype.logDislikeSmartSnippet = function () {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeDislikeSmartSnippet()];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeExpandSmartSnippet = function () {
            return this.makeCustomEvent(SearchPageEvents.expandSmartSnippet);
        };
        CoveoSearchPageClient.prototype.logExpandSmartSnippet = function () {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeExpandSmartSnippet()];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeCollapseSmartSnippet = function () {
            return this.makeCustomEvent(SearchPageEvents.collapseSmartSnippet);
        };
        CoveoSearchPageClient.prototype.logCollapseSmartSnippet = function () {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeCollapseSmartSnippet()];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeOpenSmartSnippetFeedbackModal = function () {
            return this.makeCustomEvent(SearchPageEvents.openSmartSnippetFeedbackModal);
        };
        CoveoSearchPageClient.prototype.logOpenSmartSnippetFeedbackModal = function () {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeOpenSmartSnippetFeedbackModal()];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeCloseSmartSnippetFeedbackModal = function () {
            return this.makeCustomEvent(SearchPageEvents.closeSmartSnippetFeedbackModal);
        };
        CoveoSearchPageClient.prototype.logCloseSmartSnippetFeedbackModal = function () {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeCloseSmartSnippetFeedbackModal()];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeSmartSnippetFeedbackReason = function (reason, details) {
            return this.makeCustomEvent(SearchPageEvents.sendSmartSnippetReason, { reason: reason, details: details });
        };
        CoveoSearchPageClient.prototype.logSmartSnippetFeedbackReason = function (reason, details) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeSmartSnippetFeedbackReason(reason, details)];
                        case 1: return [2, (_a.sent()).log({
                                searchUID: this.provider.getSearchUID(),
                            })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeExpandSmartSnippetSuggestion = function (snippet) {
            return this.makeCustomEvent(SearchPageEvents.expandSmartSnippetSuggestion, 'documentId' in snippet ? snippet : { documentId: snippet });
        };
        CoveoSearchPageClient.prototype.logExpandSmartSnippetSuggestion = function (snippet) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeExpandSmartSnippetSuggestion(snippet)];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeCollapseSmartSnippetSuggestion = function (snippet) {
            return this.makeCustomEvent(SearchPageEvents.collapseSmartSnippetSuggestion, 'documentId' in snippet ? snippet : { documentId: snippet });
        };
        CoveoSearchPageClient.prototype.logCollapseSmartSnippetSuggestion = function (snippet) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeCollapseSmartSnippetSuggestion(snippet)];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeShowMoreSmartSnippetSuggestion = function (snippet) {
            return this.makeCustomEvent(SearchPageEvents.showMoreSmartSnippetSuggestion, snippet);
        };
        CoveoSearchPageClient.prototype.logShowMoreSmartSnippetSuggestion = function (snippet) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeShowMoreSmartSnippetSuggestion(snippet)];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeShowLessSmartSnippetSuggestion = function (snippet) {
            return this.makeCustomEvent(SearchPageEvents.showLessSmartSnippetSuggestion, snippet);
        };
        CoveoSearchPageClient.prototype.logShowLessSmartSnippetSuggestion = function (snippet) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeShowLessSmartSnippetSuggestion(snippet)];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeOpenSmartSnippetSource = function (info, identifier) {
            return this.makeClickEvent(SearchPageEvents.openSmartSnippetSource, info, identifier);
        };
        CoveoSearchPageClient.prototype.logOpenSmartSnippetSource = function (info, identifier) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeOpenSmartSnippetSource(info, identifier)];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeOpenSmartSnippetSuggestionSource = function (info, snippet) {
            return this.makeClickEvent(SearchPageEvents.openSmartSnippetSuggestionSource, info, { contentIDKey: snippet.documentId.contentIdKey, contentIDValue: snippet.documentId.contentIdValue }, snippet);
        };
        CoveoSearchPageClient.prototype.makeCopyToClipboard = function (info, identifier) {
            return this.makeClickEvent(SearchPageEvents.copyToClipboard, info, identifier);
        };
        CoveoSearchPageClient.prototype.logCopyToClipboard = function (info, identifier) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeCopyToClipboard(info, identifier)];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.logOpenSmartSnippetSuggestionSource = function (info, snippet) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeOpenSmartSnippetSuggestionSource(info, snippet)];
                        case 1: return [2, (_a.sent()).log({
                                searchUID: this.provider.getSearchUID(),
                            })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeOpenSmartSnippetInlineLink = function (info, identifierAndLink) {
            return this.makeClickEvent(SearchPageEvents.openSmartSnippetInlineLink, info, { contentIDKey: identifierAndLink.contentIDKey, contentIDValue: identifierAndLink.contentIDValue }, identifierAndLink);
        };
        CoveoSearchPageClient.prototype.logOpenSmartSnippetInlineLink = function (info, identifierAndLink) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeOpenSmartSnippetInlineLink(info, identifierAndLink)];
                        case 1: return [2, (_a.sent()).log({
                                searchUID: this.provider.getSearchUID(),
                            })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeOpenSmartSnippetSuggestionInlineLink = function (info, snippetAndLink) {
            return this.makeClickEvent(SearchPageEvents.openSmartSnippetSuggestionInlineLink, info, {
                contentIDKey: snippetAndLink.documentId.contentIdKey,
                contentIDValue: snippetAndLink.documentId.contentIdValue,
            }, snippetAndLink);
        };
        CoveoSearchPageClient.prototype.logOpenSmartSnippetSuggestionInlineLink = function (info, snippetAndLink) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeOpenSmartSnippetSuggestionInlineLink(info, snippetAndLink)];
                        case 1: return [2, (_a.sent()).log({
                                searchUID: this.provider.getSearchUID(),
                            })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeRecentQueryClick = function () {
            return this.makeSearchEvent(SearchPageEvents.recentQueryClick);
        };
        CoveoSearchPageClient.prototype.logRecentQueryClick = function () {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeRecentQueryClick()];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeClearRecentQueries = function () {
            return this.makeCustomEvent(SearchPageEvents.clearRecentQueries);
        };
        CoveoSearchPageClient.prototype.logClearRecentQueries = function () {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeClearRecentQueries()];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeRecentResultClick = function (info, identifier) {
            return this.makeCustomEvent(SearchPageEvents.recentResultClick, { info: info, identifier: identifier });
        };
        CoveoSearchPageClient.prototype.logRecentResultClick = function (info, identifier) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeRecentResultClick(info, identifier)];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeClearRecentResults = function () {
            return this.makeCustomEvent(SearchPageEvents.clearRecentResults);
        };
        CoveoSearchPageClient.prototype.logClearRecentResults = function () {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeClearRecentResults()];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeNoResultsBack = function () {
            return this.makeSearchEvent(SearchPageEvents.noResultsBack);
        };
        CoveoSearchPageClient.prototype.logNoResultsBack = function () {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeNoResultsBack()];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeShowMoreFoldedResults = function (info, identifier) {
            return this.makeClickEvent(SearchPageEvents.showMoreFoldedResults, info, identifier);
        };
        CoveoSearchPageClient.prototype.logShowMoreFoldedResults = function (info, identifier) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeShowMoreFoldedResults(info, identifier)];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeShowLessFoldedResults = function () {
            return this.makeCustomEvent(SearchPageEvents.showLessFoldedResults);
        };
        CoveoSearchPageClient.prototype.logShowLessFoldedResults = function () {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeShowLessFoldedResults()];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeEventDescription = function (preparedEvent, actionCause) {
            var _a;
            return { actionCause: actionCause, customData: (_a = preparedEvent.payload) === null || _a === void 0 ? void 0 : _a.customData };
        };
        CoveoSearchPageClient.prototype.makeCustomEvent = function (event_1, metadata_1) {
            return __awaiter(this, arguments, void 0, function (event, metadata, eventType) {
                var customData, request, _a, preparedEvent;
                if (eventType === void 0) { eventType = CustomEventsTypes[event]; }
                return __generator(this, function (_b) {
                    switch (_b.label) {
                        case 0:
                            this.coveoAnalyticsClient.getParameters;
                            customData = __assign(__assign({}, this.provider.getBaseMetadata()), metadata);
                            _a = [{}];
                            return [4, this.getBaseEventRequest(customData)];
                        case 1:
                            request = __assign.apply(void 0, [__assign.apply(void 0, _a.concat([(_b.sent())])), { eventType: eventType, eventValue: event }]);
                            return [4, this.coveoAnalyticsClient.makeCustomEvent(request)];
                        case 2:
                            preparedEvent = _b.sent();
                            return [2, {
                                    description: this.makeEventDescription(preparedEvent, event),
                                    log: function (_a) {
                                        var searchUID = _a.searchUID;
                                        return preparedEvent.log({ lastSearchQueryUid: searchUID });
                                    },
                                }];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.logCustomEvent = function (event_1, metadata_1) {
            return __awaiter(this, arguments, void 0, function (event, metadata, eventType) {
                if (eventType === void 0) { eventType = CustomEventsTypes[event]; }
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeCustomEvent(event, metadata, eventType)];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeCustomEventWithType = function (eventValue, eventType, metadata) {
            return __awaiter(this, void 0, void 0, function () {
                var customData, payload, _a, preparedEvent;
                return __generator(this, function (_b) {
                    switch (_b.label) {
                        case 0:
                            customData = __assign(__assign({}, this.provider.getBaseMetadata()), metadata);
                            _a = [{}];
                            return [4, this.getBaseEventRequest(customData)];
                        case 1:
                            payload = __assign.apply(void 0, [__assign.apply(void 0, _a.concat([(_b.sent())])), { eventType: eventType, eventValue: eventValue }]);
                            return [4, this.coveoAnalyticsClient.makeCustomEvent(payload)];
                        case 2:
                            preparedEvent = _b.sent();
                            return [2, {
                                    description: this.makeEventDescription(preparedEvent, eventValue),
                                    log: function (_a) {
                                        var searchUID = _a.searchUID;
                                        return preparedEvent.log({ lastSearchQueryUid: searchUID });
                                    },
                                }];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.logCustomEventWithType = function (eventValue, eventType, metadata) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeCustomEventWithType(eventValue, eventType, metadata)];
                        case 1: return [2, (_a.sent()).log({
                                searchUID: this.provider.getSearchUID(),
                            })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.logSearchEvent = function (event, metadata) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeSearchEvent(event, metadata)];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeSearchEvent = function (event, metadata) {
            return __awaiter(this, void 0, void 0, function () {
                var request, preparedEvent;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.getBaseSearchEventRequest(event, metadata)];
                        case 1:
                            request = _a.sent();
                            return [4, this.coveoAnalyticsClient.makeSearchEvent(request)];
                        case 2:
                            preparedEvent = _a.sent();
                            return [2, {
                                    description: this.makeEventDescription(preparedEvent, event),
                                    log: function (_a) {
                                        var searchUID = _a.searchUID;
                                        return preparedEvent.log({ searchQueryUid: searchUID });
                                    },
                                }];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeClickEvent = function (event, info, identifier, metadata) {
            return __awaiter(this, void 0, void 0, function () {
                var request, _a, preparedEvent;
                return __generator(this, function (_b) {
                    switch (_b.label) {
                        case 0:
                            _a = [__assign({}, info)];
                            return [4, this.getBaseEventRequest(__assign(__assign({}, identifier), metadata))];
                        case 1:
                            request = __assign.apply(void 0, [__assign.apply(void 0, _a.concat([(_b.sent())])), { queryPipeline: this.provider.getPipeline(), actionCause: event }]);
                            return [4, this.coveoAnalyticsClient.makeClickEvent(request)];
                        case 2:
                            preparedEvent = _b.sent();
                            return [2, {
                                    description: this.makeEventDescription(preparedEvent, event),
                                    log: function (_a) {
                                        var searchUID = _a.searchUID;
                                        return preparedEvent.log({ searchQueryUid: searchUID });
                                    },
                                }];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.logClickEvent = function (event, info, identifier, metadata) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeClickEvent(event, info, identifier, metadata)];
                        case 1: return [2, (_a.sent()).log({
                                searchUID: this.provider.getSearchUID(),
                            })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.getBaseSearchEventRequest = function (event, metadata) {
            return __awaiter(this, void 0, void 0, function () {
                var _a;
                var _b, _c;
                return __generator(this, function (_d) {
                    switch (_d.label) {
                        case 0:
                            _a = [{}];
                            return [4, this.getBaseEventRequest(__assign(__assign({}, metadata), (_c = (_b = this.provider).getGeneratedAnswerMetadata) === null || _c === void 0 ? void 0 : _c.call(_b)))];
                        case 1: return [2, __assign.apply(void 0, [__assign.apply(void 0, [__assign.apply(void 0, _a.concat([(_d.sent())])), this.provider.getSearchEventRequestPayload()]), { queryPipeline: this.provider.getPipeline(), actionCause: event }])];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.getBaseEventRequest = function (metadata) {
            return __awaiter(this, void 0, void 0, function () {
                var customData, _a;
                var _b;
                return __generator(this, function (_c) {
                    switch (_c.label) {
                        case 0:
                            customData = __assign(__assign({}, this.provider.getBaseMetadata()), metadata);
                            _a = [__assign(__assign({}, this.getOrigins()), this.getSplitTestRun())];
                            _b = { customData: customData, language: this.provider.getLanguage(), facetState: this.provider.getFacetState ? this.provider.getFacetState() : [], anonymous: this.provider.getIsAnonymous() };
                            return [4, this.getClientId()];
                        case 1: return [2, __assign.apply(void 0, _a.concat([(_b.clientId = _c.sent(), _b)]))];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.getOrigins = function () {
            var _a, _b;
            return {
                originContext: (_b = (_a = this.provider).getOriginContext) === null || _b === void 0 ? void 0 : _b.call(_a),
                originLevel1: this.provider.getOriginLevel1(),
                originLevel2: this.provider.getOriginLevel2(),
                originLevel3: this.provider.getOriginLevel3(),
            };
        };
        CoveoSearchPageClient.prototype.getClientId = function () {
            return this.coveoAnalyticsClient instanceof CoveoAnalyticsClient
                ? this.coveoAnalyticsClient.getCurrentVisitorId()
                : undefined;
        };
        CoveoSearchPageClient.prototype.getSplitTestRun = function () {
            var splitTestRunName = this.provider.getSplitTestRunName ? this.provider.getSplitTestRunName() : '';
            var splitTestRunVersion = this.provider.getSplitTestRunVersion ? this.provider.getSplitTestRunVersion() : '';
            return __assign(__assign({}, (splitTestRunName && { splitTestRunName: splitTestRunName })), (splitTestRunVersion && { splitTestRunVersion: splitTestRunVersion }));
        };
        CoveoSearchPageClient.prototype.makeLikeGeneratedAnswer = function (metadata) {
            return this.makeCustomEvent(SearchPageEvents.likeGeneratedAnswer, metadata);
        };
        CoveoSearchPageClient.prototype.logLikeGeneratedAnswer = function (metadata) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeLikeGeneratedAnswer(metadata)];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeDislikeGeneratedAnswer = function (metadata) {
            return this.makeCustomEvent(SearchPageEvents.dislikeGeneratedAnswer, metadata);
        };
        CoveoSearchPageClient.prototype.logDislikeGeneratedAnswer = function (metadata) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeDislikeGeneratedAnswer(metadata)];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeOpenGeneratedAnswerSource = function (metadata) {
            return this.makeCustomEvent(SearchPageEvents.openGeneratedAnswerSource, metadata);
        };
        CoveoSearchPageClient.prototype.logOpenGeneratedAnswerSource = function (metadata) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeOpenGeneratedAnswerSource(metadata)];
                        case 1: return [2, (_a.sent()).log({
                                searchUID: this.provider.getSearchUID(),
                            })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeGeneratedAnswerCitationClick = function (info, citation) {
            return this.makeClickEvent(SearchPageEvents.generatedAnswerCitationClick, __assign(__assign({}, info), { documentPosition: 1 }), { contentIDKey: citation.documentId.contentIdKey, contentIDValue: citation.documentId.contentIdValue }, citation);
        };
        CoveoSearchPageClient.prototype.logGeneratedAnswerCitationClick = function (info, citation) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeGeneratedAnswerCitationClick(info, citation)];
                        case 1: return [2, (_a.sent()).log({
                                searchUID: this.provider.getSearchUID(),
                            })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeGeneratedAnswerSourceHover = function (metadata) {
            return this.makeCustomEvent(SearchPageEvents.generatedAnswerSourceHover, metadata);
        };
        CoveoSearchPageClient.prototype.logGeneratedAnswerSourceHover = function (metadata) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeGeneratedAnswerSourceHover(metadata)];
                        case 1: return [2, (_a.sent()).log({
                                searchUID: this.provider.getSearchUID(),
                            })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeGeneratedAnswerCopyToClipboard = function (metadata) {
            return this.makeCustomEvent(SearchPageEvents.generatedAnswerCopyToClipboard, metadata);
        };
        CoveoSearchPageClient.prototype.logGeneratedAnswerCopyToClipboard = function (metadata) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeGeneratedAnswerCopyToClipboard(metadata)];
                        case 1: return [2, (_a.sent()).log({
                                searchUID: this.provider.getSearchUID(),
                            })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeGeneratedAnswerHideAnswers = function (metadata) {
            return this.makeCustomEvent(SearchPageEvents.generatedAnswerHideAnswers, metadata);
        };
        CoveoSearchPageClient.prototype.logGeneratedAnswerHideAnswers = function (metadata) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeGeneratedAnswerHideAnswers(metadata)];
                        case 1: return [2, (_a.sent()).log({
                                searchUID: this.provider.getSearchUID(),
                            })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeGeneratedAnswerShowAnswers = function (metadata) {
            return this.makeCustomEvent(SearchPageEvents.generatedAnswerShowAnswers, metadata);
        };
        CoveoSearchPageClient.prototype.logGeneratedAnswerShowAnswers = function (metadata) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeGeneratedAnswerShowAnswers(metadata)];
                        case 1: return [2, (_a.sent()).log({
                                searchUID: this.provider.getSearchUID(),
                            })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeGeneratedAnswerExpand = function (metadata) {
            return this.makeCustomEvent(SearchPageEvents.generatedAnswerExpand, metadata);
        };
        CoveoSearchPageClient.prototype.logGeneratedAnswerExpand = function (metadata) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeGeneratedAnswerExpand(metadata)];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeGeneratedAnswerCollapse = function (metadata) {
            return this.makeCustomEvent(SearchPageEvents.generatedAnswerCollapse, metadata);
        };
        CoveoSearchPageClient.prototype.logGeneratedAnswerCollapse = function (metadata) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeGeneratedAnswerCollapse(metadata)];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeGeneratedAnswerFeedbackSubmit = function (meta) {
            return this.makeCustomEvent(SearchPageEvents.generatedAnswerFeedbackSubmit, meta);
        };
        CoveoSearchPageClient.prototype.logGeneratedAnswerFeedbackSubmit = function (meta) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeGeneratedAnswerFeedbackSubmit(meta)];
                        case 1: return [2, (_a.sent()).log({
                                searchUID: this.provider.getSearchUID(),
                            })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeGeneratedAnswerFeedbackSubmitV2 = function (metadata) {
            return this.makeCustomEvent(SearchPageEvents.generatedAnswerFeedbackSubmitV2, metadata);
        };
        CoveoSearchPageClient.prototype.logGeneratedAnswerFeedbackSubmitV2 = function (meta) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeGeneratedAnswerFeedbackSubmitV2(meta)];
                        case 1: return [2, (_a.sent()).log({
                                searchUID: this.provider.getSearchUID(),
                            })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeRephraseGeneratedAnswer = function (meta) {
            return this.makeSearchEvent(SearchPageEvents.rephraseGeneratedAnswer, meta);
        };
        CoveoSearchPageClient.prototype.logRephraseGeneratedAnswer = function (meta) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeRephraseGeneratedAnswer(meta)];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeRetryGeneratedAnswer = function () {
            return this.makeSearchEvent(SearchPageEvents.retryGeneratedAnswer);
        };
        CoveoSearchPageClient.prototype.logRetryGeneratedAnswer = function () {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeRetryGeneratedAnswer()];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        CoveoSearchPageClient.prototype.makeGeneratedAnswerStreamEnd = function (metadata) {
            return this.makeCustomEvent(SearchPageEvents.generatedAnswerStreamEnd, metadata);
        };
        CoveoSearchPageClient.prototype.logGeneratedAnswerStreamEnd = function (metadata) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.makeGeneratedAnswerStreamEnd(metadata)];
                        case 1: return [2, (_a.sent()).log({ searchUID: this.provider.getSearchUID() })];
                    }
                });
            });
        };
        return CoveoSearchPageClient;
    }());

    var CaseAssistEvents;
    (function (CaseAssistEvents) {
        CaseAssistEvents["click"] = "click";
        CaseAssistEvents["flowStart"] = "flowStart";
    })(CaseAssistEvents || (CaseAssistEvents = {}));
    var CaseAssistActions;
    (function (CaseAssistActions) {
        CaseAssistActions["enterInterface"] = "ticket_create_start";
        CaseAssistActions["fieldUpdate"] = "ticket_field_update";
        CaseAssistActions["fieldSuggestionClick"] = "ticket_classification_click";
        CaseAssistActions["documentSuggestionClick"] = "documentSuggestionClick";
        CaseAssistActions["documentSuggestionQuickview"] = "documentSuggestionQuickview";
        CaseAssistActions["suggestionRate"] = "suggestion_rate";
        CaseAssistActions["nextCaseStep"] = "ticket_next_stage";
        CaseAssistActions["caseCancelled"] = "ticket_cancel";
        CaseAssistActions["caseSolved"] = "ticket_cancel";
        CaseAssistActions["caseCreated"] = "ticket_create";
    })(CaseAssistActions || (CaseAssistActions = {}));
    var CaseCancelledReasons;
    (function (CaseCancelledReasons) {
        CaseCancelledReasons["quit"] = "Quit";
        CaseCancelledReasons["solved"] = "Solved";
    })(CaseCancelledReasons || (CaseCancelledReasons = {}));

    var CaseAssistClient = (function () {
        function CaseAssistClient(options, provider) {
            var _a;
            this.options = options;
            this.provider = provider;
            var analyticsEnabled = ((_a = options.enableAnalytics) !== null && _a !== void 0 ? _a : true) && !doNotTrack();
            this.coveoAnalyticsClient = analyticsEnabled ? new CoveoAnalyticsClient(options) : new NoopAnalytics();
            this.svc = new SVCPlugin({ client: this.coveoAnalyticsClient });
        }
        CaseAssistClient.prototype.disable = function () {
            this.coveoAnalyticsClient = new NoopAnalytics();
            this.svc = new SVCPlugin({ client: this.coveoAnalyticsClient });
        };
        CaseAssistClient.prototype.enable = function () {
            this.coveoAnalyticsClient = new CoveoAnalyticsClient(this.options);
            this.svc = new SVCPlugin({ client: this.coveoAnalyticsClient });
        };
        CaseAssistClient.prototype.logEnterInterface = function (meta) {
            this.svc.setAction(CaseAssistActions.enterInterface);
            this.svc.setTicket(meta.ticket);
            return this.sendFlowStartEvent();
        };
        CaseAssistClient.prototype.logUpdateCaseField = function (meta) {
            this.svc.setAction(CaseAssistActions.fieldUpdate, {
                fieldName: meta.fieldName,
            });
            this.svc.setTicket(meta.ticket);
            return this.sendClickEvent();
        };
        CaseAssistClient.prototype.logSelectFieldSuggestion = function (meta) {
            this.svc.setAction(CaseAssistActions.fieldSuggestionClick, meta.suggestion);
            this.svc.setTicket(meta.ticket);
            return this.sendClickEvent();
        };
        CaseAssistClient.prototype.logSelectDocumentSuggestion = function (meta) {
            return this.logClickEvent(CaseAssistActions.documentSuggestionClick, meta.suggestion.suggestion, {
                contentIDKey: 'permanentId',
                contentIDValue: meta.suggestion.permanentId,
            });
        };
        CaseAssistClient.prototype.logQuickviewDocumentSuggestion = function (meta) {
            return this.logClickEvent(CaseAssistActions.documentSuggestionQuickview, meta.suggestion.suggestion, {
                contentIDKey: 'permanentId',
                contentIDValue: meta.suggestion.permanentId,
            });
        };
        CaseAssistClient.prototype.logRateDocumentSuggestion = function (meta) {
            this.svc.setAction(CaseAssistActions.suggestionRate, __assign({ rate: meta.rating }, meta.suggestion));
            this.svc.setTicket(meta.ticket);
            return this.sendClickEvent();
        };
        CaseAssistClient.prototype.logMoveToNextCaseStep = function (meta) {
            this.svc.setAction(CaseAssistActions.nextCaseStep, {
                stage: meta === null || meta === void 0 ? void 0 : meta.stage,
            });
            this.svc.setTicket(meta.ticket);
            return this.sendClickEvent();
        };
        CaseAssistClient.prototype.logCaseCancelled = function (meta) {
            this.svc.setAction(CaseAssistActions.caseCancelled, {
                reason: CaseCancelledReasons.quit,
            });
            this.svc.setTicket(meta.ticket);
            return this.sendClickEvent();
        };
        CaseAssistClient.prototype.logCaseSolved = function (meta) {
            this.svc.setAction(CaseAssistActions.caseSolved, {
                reason: CaseCancelledReasons.solved,
            });
            this.svc.setTicket(meta.ticket);
            return this.sendClickEvent();
        };
        CaseAssistClient.prototype.logCaseCreated = function (meta) {
            this.svc.setAction(CaseAssistActions.caseCreated);
            this.svc.setTicket(meta.ticket);
            return this.sendClickEvent();
        };
        CaseAssistClient.prototype.sendFlowStartEvent = function () {
            return this.coveoAnalyticsClient.sendEvent('event', 'svc', CaseAssistEvents.flowStart, this.provider
                ? {
                    searchHub: this.provider.getOriginLevel1(),
                }
                : null);
        };
        CaseAssistClient.prototype.sendClickEvent = function () {
            return this.coveoAnalyticsClient.sendEvent('event', 'svc', CaseAssistEvents.click, this.provider
                ? {
                    searchHub: this.provider.getOriginLevel1(),
                }
                : null);
        };
        CaseAssistClient.prototype.getBaseEventRequest = function (metadata) {
            return __awaiter(this, void 0, void 0, function () {
                var customData, _a;
                var _b;
                var _c, _d;
                return __generator(this, function (_e) {
                    switch (_e.label) {
                        case 0:
                            customData = __assign({}, metadata);
                            _a = [__assign({}, this.getOrigins())];
                            _b = { customData: customData, language: (_c = this.provider) === null || _c === void 0 ? void 0 : _c.getLanguage(), anonymous: (_d = this.provider) === null || _d === void 0 ? void 0 : _d.getIsAnonymous() };
                            return [4, this.getClientId()];
                        case 1: return [2, __assign.apply(void 0, _a.concat([(_b.clientId = _e.sent(), _b)]))];
                    }
                });
            });
        };
        CaseAssistClient.prototype.getClientId = function () {
            return this.coveoAnalyticsClient instanceof CoveoAnalyticsClient
                ? this.coveoAnalyticsClient.getCurrentVisitorId()
                : undefined;
        };
        CaseAssistClient.prototype.getOrigins = function () {
            var _a, _b, _c, _d, _e;
            return {
                originContext: (_b = (_a = this.provider) === null || _a === void 0 ? void 0 : _a.getOriginContext) === null || _b === void 0 ? void 0 : _b.call(_a),
                originLevel1: (_c = this.provider) === null || _c === void 0 ? void 0 : _c.getOriginLevel1(),
                originLevel2: (_d = this.provider) === null || _d === void 0 ? void 0 : _d.getOriginLevel2(),
                originLevel3: (_e = this.provider) === null || _e === void 0 ? void 0 : _e.getOriginLevel3(),
            };
        };
        CaseAssistClient.prototype.logClickEvent = function (event, info, identifier, metadata) {
            return __awaiter(this, void 0, void 0, function () {
                var payload, _a;
                var _b, _c;
                return __generator(this, function (_d) {
                    switch (_d.label) {
                        case 0:
                            _a = [__assign({}, info)];
                            return [4, this.getBaseEventRequest(__assign(__assign({}, identifier), metadata))];
                        case 1:
                            payload = __assign.apply(void 0, [__assign.apply(void 0, _a.concat([(_d.sent())])), { searchQueryUid: (_c = (_b = this.provider) === null || _b === void 0 ? void 0 : _b.getSearchUID()) !== null && _c !== void 0 ? _c : '', actionCause: event }]);
                            return [2, this.coveoAnalyticsClient.sendClickEvent(payload)];
                    }
                });
            });
        };
        return CaseAssistClient;
    }());

    var extractContextFromMetadata = function (meta) {
        var context = {};
        if (meta.caseContext) {
            Object.keys(meta.caseContext).forEach(function (contextKey) {
                var _a;
                var value = (_a = meta.caseContext) === null || _a === void 0 ? void 0 : _a[contextKey];
                if (value) {
                    var keyToBeSent = "context_".concat(contextKey);
                    context[keyToBeSent] = value;
                }
            });
        }
        return context;
    };
    var generateMetadataToSend = function (metadata, includeContext) {
        if (includeContext === void 0) { includeContext = true; }
        metadata.caseContext; var caseId = metadata.caseId, caseNumber = metadata.caseNumber, metadataWithoutContext = __rest(metadata, ["caseContext", "caseId", "caseNumber"]);
        var context = extractContextFromMetadata(metadata);
        return __assign(__assign(__assign({ CaseId: caseId, CaseNumber: caseNumber }, metadataWithoutContext), (!!context.context_Case_Subject && { CaseSubject: context.context_Case_Subject })), (includeContext && context));
    };
    var CoveoInsightClient = (function () {
        function CoveoInsightClient(opts, provider) {
            this.opts = opts;
            this.provider = provider;
            var shouldDisableAnalytics = opts.enableAnalytics === false || doNotTrack();
            this.coveoAnalyticsClient = shouldDisableAnalytics ? new NoopAnalytics() : new CoveoAnalyticsClient(opts);
        }
        CoveoInsightClient.prototype.disable = function () {
            this.coveoAnalyticsClient = new NoopAnalytics();
        };
        CoveoInsightClient.prototype.enable = function () {
            this.coveoAnalyticsClient = new CoveoAnalyticsClient(this.opts);
        };
        CoveoInsightClient.prototype.logInterfaceLoad = function (metadata) {
            if (metadata) {
                var metadataToSend = generateMetadataToSend(metadata);
                return this.logSearchEvent(SearchPageEvents.interfaceLoad, metadataToSend);
            }
            return this.logSearchEvent(SearchPageEvents.interfaceLoad);
        };
        CoveoInsightClient.prototype.logRecentQueryClick = function (metadata) {
            if (metadata) {
                var metadataToSend = generateMetadataToSend(metadata);
                return this.logSearchEvent(SearchPageEvents.recentQueryClick, metadataToSend);
            }
            return this.logSearchEvent(SearchPageEvents.recentQueryClick);
        };
        CoveoInsightClient.prototype.logClearRecentQueries = function (metadata) {
            if (metadata) {
                var metadataToSend = generateMetadataToSend(metadata);
                return this.logCustomEvent(SearchPageEvents.clearRecentQueries, metadataToSend);
            }
            return this.logCustomEvent(SearchPageEvents.clearRecentQueries);
        };
        CoveoInsightClient.prototype.logInterfaceChange = function (metadata) {
            var metadataToSend = generateMetadataToSend(metadata);
            return this.logSearchEvent(SearchPageEvents.interfaceChange, metadataToSend);
        };
        CoveoInsightClient.prototype.logStaticFilterDeselect = function (metadata) {
            var metadataToSend = generateMetadataToSend(metadata);
            return this.logSearchEvent(SearchPageEvents.staticFilterDeselect, metadataToSend);
        };
        CoveoInsightClient.prototype.logFetchMoreResults = function (metadata) {
            if (metadata) {
                var metadataToSend = generateMetadataToSend(metadata);
                return this.logCustomEvent(SearchPageEvents.pagerScrolling, __assign(__assign({}, metadataToSend), { type: 'getMoreResults' }));
            }
            return this.logCustomEvent(SearchPageEvents.pagerScrolling, { type: 'getMoreResults' });
        };
        CoveoInsightClient.prototype.logBreadcrumbFacet = function (metadata) {
            var metadataToSend = generateMetadataToSend(metadata);
            return this.logSearchEvent(SearchPageEvents.breadcrumbFacet, metadataToSend);
        };
        CoveoInsightClient.prototype.logBreadcrumbResetAll = function (metadata) {
            if (metadata) {
                var metadataToSend = generateMetadataToSend(metadata);
                return this.logSearchEvent(SearchPageEvents.breadcrumbResetAll, metadataToSend);
            }
            return this.logSearchEvent(SearchPageEvents.breadcrumbResetAll);
        };
        CoveoInsightClient.prototype.logFacetSelect = function (metadata) {
            var metadataToSend = generateMetadataToSend(metadata);
            return this.logSearchEvent(SearchPageEvents.facetSelect, metadataToSend);
        };
        CoveoInsightClient.prototype.logFacetExclude = function (metadata) {
            var metadataToSend = generateMetadataToSend(metadata);
            return this.logSearchEvent(SearchPageEvents.facetExclude, metadataToSend);
        };
        CoveoInsightClient.prototype.logFacetDeselect = function (metadata) {
            var metadataToSend = generateMetadataToSend(metadata);
            return this.logSearchEvent(SearchPageEvents.facetDeselect, metadataToSend);
        };
        CoveoInsightClient.prototype.logFacetUpdateSort = function (metadata) {
            var metadataToSend = generateMetadataToSend(metadata);
            return this.logSearchEvent(SearchPageEvents.facetUpdateSort, metadataToSend);
        };
        CoveoInsightClient.prototype.logFacetClearAll = function (metadata) {
            var metadataToSend = generateMetadataToSend(metadata);
            return this.logSearchEvent(SearchPageEvents.facetClearAll, metadataToSend);
        };
        CoveoInsightClient.prototype.logFacetShowMore = function (metadata) {
            var metadataToSend = generateMetadataToSend(metadata, false);
            return this.logCustomEvent(SearchPageEvents.facetShowMore, metadataToSend);
        };
        CoveoInsightClient.prototype.logFacetShowLess = function (metadata) {
            var metadataToSend = generateMetadataToSend(metadata, false);
            return this.logCustomEvent(SearchPageEvents.facetShowLess, metadataToSend);
        };
        CoveoInsightClient.prototype.logQueryError = function (metadata) {
            var metadataToSend = generateMetadataToSend(metadata, false);
            return this.logCustomEvent(SearchPageEvents.queryError, metadataToSend);
        };
        CoveoInsightClient.prototype.logPagerNumber = function (metadata) {
            var metadataToSend = generateMetadataToSend(metadata, false);
            return this.logCustomEvent(SearchPageEvents.pagerNumber, metadataToSend);
        };
        CoveoInsightClient.prototype.logPagerNext = function (metadata) {
            var metadataToSend = generateMetadataToSend(metadata, false);
            return this.logCustomEvent(SearchPageEvents.pagerNext, metadataToSend);
        };
        CoveoInsightClient.prototype.logPagerPrevious = function (metadata) {
            var metadataToSend = generateMetadataToSend(metadata, false);
            return this.logCustomEvent(SearchPageEvents.pagerPrevious, metadataToSend);
        };
        CoveoInsightClient.prototype.logDidYouMeanAutomatic = function (metadata) {
            if (metadata) {
                var metadataToSend = generateMetadataToSend(metadata);
                return this.logSearchEvent(SearchPageEvents.didyoumeanAutomatic, metadataToSend);
            }
            return this.logSearchEvent(SearchPageEvents.didyoumeanAutomatic);
        };
        CoveoInsightClient.prototype.logDidYouMeanClick = function (metadata) {
            if (metadata) {
                var metadataToSend = generateMetadataToSend(metadata);
                return this.logSearchEvent(SearchPageEvents.didyoumeanClick, metadataToSend);
            }
            return this.logSearchEvent(SearchPageEvents.didyoumeanClick);
        };
        CoveoInsightClient.prototype.logResultsSort = function (metadata) {
            var metadataToSend = generateMetadataToSend(metadata);
            return this.logSearchEvent(SearchPageEvents.resultsSort, metadataToSend);
        };
        CoveoInsightClient.prototype.logSearchboxSubmit = function (metadata) {
            if (metadata) {
                var metadataToSend = generateMetadataToSend(metadata);
                return this.logSearchEvent(SearchPageEvents.searchboxSubmit, metadataToSend);
            }
            return this.logSearchEvent(SearchPageEvents.searchboxSubmit);
        };
        CoveoInsightClient.prototype.logContextChanged = function (metadata) {
            var metadataToSend = generateMetadataToSend(metadata);
            return this.logSearchEvent(InsightEvents.contextChanged, metadataToSend);
        };
        CoveoInsightClient.prototype.logExpandToFullUI = function (metadata) {
            var metadataToSend = generateMetadataToSend(metadata);
            return this.logCustomEvent(InsightEvents.expandToFullUI, metadataToSend);
        };
        CoveoInsightClient.prototype.logOpenUserActions = function (metadata) {
            var metadataToSend = generateMetadataToSend(metadata, false);
            return this.logCustomEvent(InsightEvents.openUserActions, metadataToSend);
        };
        CoveoInsightClient.prototype.logShowPrecedingSessions = function (metadata) {
            var metadataToSend = generateMetadataToSend(metadata, false);
            return this.logCustomEvent(InsightEvents.showPrecedingSessions, metadataToSend);
        };
        CoveoInsightClient.prototype.logShowFollowingSessions = function (metadata) {
            var metadataToSend = generateMetadataToSend(metadata, false);
            return this.logCustomEvent(InsightEvents.showFollowingSessions, metadataToSend);
        };
        CoveoInsightClient.prototype.logViewedDocumentClick = function (document, metadata) {
            return this.logCustomEvent(InsightEvents.clickViewedDocument, __assign(__assign({}, generateMetadataToSend(metadata, false)), { document: document }));
        };
        CoveoInsightClient.prototype.logPageViewClick = function (pageView, metadata) {
            return this.logCustomEvent(InsightEvents.clickPageView, __assign(__assign({}, generateMetadataToSend(metadata, false)), { pageView: pageView }));
        };
        CoveoInsightClient.prototype.logCreateArticle = function (createArticleMetadata, metadata) {
            return this.logCustomEvent(InsightEvents.createArticle, metadata ? __assign(__assign({}, generateMetadataToSend(metadata, false)), createArticleMetadata) : createArticleMetadata);
        };
        CoveoInsightClient.prototype.logDocumentOpen = function (info, identifier, metadata) {
            return this.logClickEvent(SearchPageEvents.documentOpen, info, identifier, metadata ? generateMetadataToSend(metadata, false) : undefined);
        };
        CoveoInsightClient.prototype.logCopyToClipboard = function (info, identifier, metadata) {
            return this.logClickEvent(SearchPageEvents.copyToClipboard, info, identifier, metadata ? generateMetadataToSend(metadata, false) : undefined);
        };
        CoveoInsightClient.prototype.logCaseSendEmail = function (info, identifier, metadata) {
            return this.logClickEvent(SearchPageEvents.caseSendEmail, info, identifier, metadata ? generateMetadataToSend(metadata, false) : undefined);
        };
        CoveoInsightClient.prototype.logFeedItemTextPost = function (info, identifier, metadata) {
            return this.logClickEvent(SearchPageEvents.feedItemTextPost, info, identifier, metadata ? generateMetadataToSend(metadata, false) : undefined);
        };
        CoveoInsightClient.prototype.logDocumentQuickview = function (info, identifier, caseMetadata) {
            var metadata = {
                documentTitle: info.documentTitle,
                documentURL: info.documentUrl,
            };
            return this.logClickEvent(SearchPageEvents.documentQuickview, info, identifier, caseMetadata ? __assign(__assign({}, generateMetadataToSend(caseMetadata, false)), metadata) : metadata);
        };
        CoveoInsightClient.prototype.logCaseAttach = function (info, identifier, caseMetadata) {
            var metadata = {
                documentTitle: info.documentTitle,
                documentURL: info.documentUrl,
                resultUriHash: info.documentUriHash,
            };
            return this.logClickEvent(SearchPageEvents.caseAttach, info, identifier, caseMetadata ? __assign(__assign({}, generateMetadataToSend(caseMetadata, false)), metadata) : metadata);
        };
        CoveoInsightClient.prototype.logCaseDetach = function (resultUriHash, metadata, permanentId) {
            var generatedMetadata = __assign(__assign(__assign({}, (metadata && generateMetadataToSend(metadata, false))), (permanentId && { permanentId: permanentId })), { resultUriHash: resultUriHash });
            return this.logCustomEvent(SearchPageEvents.caseDetach, generatedMetadata);
        };
        CoveoInsightClient.prototype.logLikeSmartSnippet = function (metadata) {
            return this.logCustomEvent(SearchPageEvents.likeSmartSnippet, metadata ? generateMetadataToSend(metadata, false) : undefined);
        };
        CoveoInsightClient.prototype.logDislikeSmartSnippet = function (metadata) {
            return this.logCustomEvent(SearchPageEvents.dislikeSmartSnippet, metadata ? generateMetadataToSend(metadata, false) : undefined);
        };
        CoveoInsightClient.prototype.logExpandSmartSnippet = function (metadata) {
            return this.logCustomEvent(SearchPageEvents.expandSmartSnippet, metadata ? generateMetadataToSend(metadata, false) : undefined);
        };
        CoveoInsightClient.prototype.logCollapseSmartSnippet = function (metadata) {
            return this.logCustomEvent(SearchPageEvents.collapseSmartSnippet, metadata ? generateMetadataToSend(metadata, false) : undefined);
        };
        CoveoInsightClient.prototype.logOpenSmartSnippetFeedbackModal = function (metadata) {
            return this.logCustomEvent(SearchPageEvents.openSmartSnippetFeedbackModal, metadata ? generateMetadataToSend(metadata, false) : undefined);
        };
        CoveoInsightClient.prototype.logCloseSmartSnippetFeedbackModal = function (metadata) {
            return this.logCustomEvent(SearchPageEvents.closeSmartSnippetFeedbackModal, metadata ? generateMetadataToSend(metadata, false) : undefined);
        };
        CoveoInsightClient.prototype.logSmartSnippetFeedbackReason = function (reason, details, metadata) {
            return this.logCustomEvent(SearchPageEvents.sendSmartSnippetReason, metadata ? __assign(__assign({}, generateMetadataToSend(metadata, false)), { reason: reason, details: details }) : { reason: reason, details: details });
        };
        CoveoInsightClient.prototype.logExpandSmartSnippetSuggestion = function (snippet, metadata) {
            var snippetMetadata = 'documentId' in snippet ? snippet : { documentId: snippet };
            return this.logCustomEvent(SearchPageEvents.expandSmartSnippetSuggestion, metadata ? __assign(__assign({}, generateMetadataToSend(metadata, false)), snippetMetadata) : snippetMetadata);
        };
        CoveoInsightClient.prototype.logCollapseSmartSnippetSuggestion = function (snippet, metadata) {
            var snippetMetadata = 'documentId' in snippet ? snippet : { documentId: snippet };
            return this.logCustomEvent(SearchPageEvents.collapseSmartSnippetSuggestion, metadata ? __assign(__assign({}, generateMetadataToSend(metadata, false)), snippetMetadata) : snippetMetadata);
        };
        CoveoInsightClient.prototype.logOpenSmartSnippetSource = function (info, identifier, metadata) {
            return this.logClickEvent(SearchPageEvents.openSmartSnippetSource, info, identifier, metadata ? generateMetadataToSend(metadata, false) : undefined);
        };
        CoveoInsightClient.prototype.logOpenSmartSnippetSuggestionSource = function (info, snippet, metadata) {
            return this.logClickEvent(SearchPageEvents.openSmartSnippetSuggestionSource, info, { contentIDKey: snippet.documentId.contentIdKey, contentIDValue: snippet.documentId.contentIdValue }, metadata ? __assign(__assign({}, generateMetadataToSend(metadata, false)), snippet) : snippet);
        };
        CoveoInsightClient.prototype.logOpenSmartSnippetInlineLink = function (info, identifierAndLink, metadata) {
            return this.logClickEvent(SearchPageEvents.openSmartSnippetInlineLink, info, { contentIDKey: identifierAndLink.contentIDKey, contentIDValue: identifierAndLink.contentIDValue }, metadata ? __assign(__assign({}, generateMetadataToSend(metadata, false)), identifierAndLink) : identifierAndLink);
        };
        CoveoInsightClient.prototype.logOpenSmartSnippetSuggestionInlineLink = function (info, snippetAndLink, metadata) {
            return this.logClickEvent(SearchPageEvents.openSmartSnippetSuggestionInlineLink, info, {
                contentIDKey: snippetAndLink.documentId.contentIdKey,
                contentIDValue: snippetAndLink.documentId.contentIdValue,
            }, metadata ? __assign(__assign({}, generateMetadataToSend(metadata, false)), snippetAndLink) : snippetAndLink);
        };
        CoveoInsightClient.prototype.logLikeGeneratedAnswer = function (generatedAnswerMetadata, metadata) {
            return this.logCustomEvent(SearchPageEvents.likeGeneratedAnswer, metadata
                ? __assign(__assign({}, generateMetadataToSend(metadata, false)), generatedAnswerMetadata) : generatedAnswerMetadata);
        };
        CoveoInsightClient.prototype.logDislikeGeneratedAnswer = function (generatedAnswerMetadata, metadata) {
            return this.logCustomEvent(SearchPageEvents.dislikeGeneratedAnswer, metadata
                ? __assign(__assign({}, generateMetadataToSend(metadata, false)), generatedAnswerMetadata) : generatedAnswerMetadata);
        };
        CoveoInsightClient.prototype.logOpenGeneratedAnswerSource = function (generatedAnswerSourceMetadata, metadata) {
            return this.logCustomEvent(SearchPageEvents.openGeneratedAnswerSource, metadata
                ? __assign(__assign({}, generateMetadataToSend(metadata, false)), generatedAnswerSourceMetadata) : generatedAnswerSourceMetadata);
        };
        CoveoInsightClient.prototype.logGeneratedAnswerCitationClick = function (info, citation, metadata) {
            return this.logClickEvent(SearchPageEvents.generatedAnswerCitationClick, __assign(__assign({}, info), { documentPosition: 1 }), { contentIDKey: citation.documentId.contentIdKey, contentIDValue: citation.documentId.contentIdValue }, metadata ? __assign(__assign({}, generateMetadataToSend(metadata, false)), citation) : citation);
        };
        CoveoInsightClient.prototype.logGeneratedAnswerSourceHover = function (generatedAnswerSourceMetadata, metadata) {
            return this.logCustomEvent(SearchPageEvents.generatedAnswerSourceHover, metadata
                ? __assign(__assign({}, generateMetadataToSend(metadata, false)), generatedAnswerSourceMetadata) : generatedAnswerSourceMetadata);
        };
        CoveoInsightClient.prototype.logGeneratedAnswerCopyToClipboard = function (generatedAnswerMetadata, metadata) {
            return this.logCustomEvent(SearchPageEvents.generatedAnswerCopyToClipboard, metadata
                ? __assign(__assign({}, generateMetadataToSend(metadata, false)), generatedAnswerMetadata) : generatedAnswerMetadata);
        };
        CoveoInsightClient.prototype.logGeneratedAnswerHideAnswers = function (generatedAnswerMetadata, metadata) {
            return this.logCustomEvent(SearchPageEvents.generatedAnswerHideAnswers, metadata
                ? __assign(__assign({}, generateMetadataToSend(metadata, false)), generatedAnswerMetadata) : generatedAnswerMetadata);
        };
        CoveoInsightClient.prototype.logGeneratedAnswerShowAnswers = function (generatedAnswerMetadata, metadata) {
            return this.logCustomEvent(SearchPageEvents.generatedAnswerShowAnswers, metadata
                ? __assign(__assign({}, generateMetadataToSend(metadata, false)), generatedAnswerMetadata) : generatedAnswerMetadata);
        };
        CoveoInsightClient.prototype.logGeneratedAnswerExpand = function (generatedAnswerMetadata, metadata) {
            return this.logCustomEvent(SearchPageEvents.generatedAnswerExpand, metadata
                ? __assign(__assign({}, generateMetadataToSend(metadata, false)), generatedAnswerMetadata) : generatedAnswerMetadata);
        };
        CoveoInsightClient.prototype.logGeneratedAnswerCollapse = function (generatedAnswerMetadata, metadata) {
            return this.logCustomEvent(SearchPageEvents.generatedAnswerCollapse, metadata
                ? __assign(__assign({}, generateMetadataToSend(metadata, false)), generatedAnswerMetadata) : generatedAnswerMetadata);
        };
        CoveoInsightClient.prototype.logGeneratedAnswerFeedbackSubmit = function (generatedAnswerFeedbackMetadata, metadata) {
            return this.logCustomEvent(SearchPageEvents.generatedAnswerFeedbackSubmit, metadata
                ? __assign(__assign({}, generateMetadataToSend(metadata, false)), generatedAnswerFeedbackMetadata) : generatedAnswerFeedbackMetadata);
        };
        CoveoInsightClient.prototype.logGeneratedAnswerFeedbackSubmitV2 = function (generatedAnswerFeedbackMetadata, metadata) {
            return this.logCustomEvent(SearchPageEvents.generatedAnswerFeedbackSubmitV2, metadata
                ? __assign(__assign({}, generateMetadataToSend(metadata, false)), generatedAnswerFeedbackMetadata) : generatedAnswerFeedbackMetadata);
        };
        CoveoInsightClient.prototype.logRephraseGeneratedAnswer = function (generatedAnswerRephraseMetadata, metadata) {
            return this.logSearchEvent(SearchPageEvents.rephraseGeneratedAnswer, metadata
                ? __assign(__assign({}, generateMetadataToSend(metadata, false)), generatedAnswerRephraseMetadata) : generatedAnswerRephraseMetadata);
        };
        CoveoInsightClient.prototype.logRetryGeneratedAnswer = function (metadata) {
            return this.logSearchEvent(SearchPageEvents.retryGeneratedAnswer, metadata ? __assign({}, generateMetadataToSend(metadata, false)) : {});
        };
        CoveoInsightClient.prototype.logGeneratedAnswerStreamEnd = function (generatedAnswerStreamEndMetadata, metadata) {
            return this.logCustomEvent(SearchPageEvents.generatedAnswerStreamEnd, metadata
                ? __assign(__assign({}, generateMetadataToSend(metadata, false)), generatedAnswerStreamEndMetadata) : generatedAnswerStreamEndMetadata);
        };
        CoveoInsightClient.prototype.logGeneratedAnswerCitationDocumentAttach = function (info, citation, metadata) {
            return this.logClickEvent(SearchPageEvents.generatedAnswerCitationDocumentAttach, __assign(__assign({}, info), { documentPosition: 1 }), { contentIDKey: citation.documentId.contentIdKey, contentIDValue: citation.documentId.contentIdValue }, metadata ? __assign(__assign({}, generateMetadataToSend(metadata, false)), citation) : citation);
        };
        CoveoInsightClient.prototype.logCustomEvent = function (event, metadata) {
            return __awaiter(this, void 0, void 0, function () {
                var customData, payload, _a;
                return __generator(this, function (_b) {
                    switch (_b.label) {
                        case 0:
                            customData = __assign(__assign({}, this.provider.getBaseMetadata()), metadata);
                            _a = [{}];
                            return [4, this.getBaseCustomEventRequest(customData)];
                        case 1:
                            payload = __assign.apply(void 0, [__assign.apply(void 0, _a.concat([(_b.sent())])), { eventType: CustomEventsTypes[event], eventValue: event }]);
                            return [2, this.coveoAnalyticsClient.sendCustomEvent(payload)];
                    }
                });
            });
        };
        CoveoInsightClient.prototype.logSearchEvent = function (event, metadata) {
            return __awaiter(this, void 0, void 0, function () {
                var _a, _b;
                return __generator(this, function (_c) {
                    switch (_c.label) {
                        case 0:
                            _b = (_a = this.coveoAnalyticsClient).sendSearchEvent;
                            return [4, this.getBaseSearchEventRequest(event, metadata)];
                        case 1: return [2, _b.apply(_a, [_c.sent()])];
                    }
                });
            });
        };
        CoveoInsightClient.prototype.logClickEvent = function (event, info, identifier, metadata) {
            return __awaiter(this, void 0, void 0, function () {
                var payload, _a;
                return __generator(this, function (_b) {
                    switch (_b.label) {
                        case 0:
                            _a = [__assign({}, info)];
                            return [4, this.getBaseEventRequest(__assign(__assign({}, identifier), metadata))];
                        case 1:
                            payload = __assign.apply(void 0, [__assign.apply(void 0, _a.concat([(_b.sent())])), { searchQueryUid: this.provider.getSearchUID(), queryPipeline: this.provider.getPipeline(), actionCause: event }]);
                            return [2, this.coveoAnalyticsClient.sendClickEvent(payload)];
                    }
                });
            });
        };
        CoveoInsightClient.prototype.logShowMoreFoldedResults = function (info, identifier, metadata) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    return [2, this.logClickEvent(SearchPageEvents.showMoreFoldedResults, info, identifier, metadata ? generateMetadataToSend(metadata, false) : undefined)];
                });
            });
        };
        CoveoInsightClient.prototype.logShowLessFoldedResults = function (metadata) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    return [2, this.logCustomEvent(SearchPageEvents.showLessFoldedResults, metadata ? generateMetadataToSend(metadata, false) : undefined)];
                });
            });
        };
        CoveoInsightClient.prototype.logTriggerNotify = function (triggerNotifyMetadata, metadata) {
            return this.logCustomEvent(SearchPageEvents.triggerNotify, metadata ? __assign(__assign({}, generateMetadataToSend(metadata, false)), triggerNotifyMetadata) : triggerNotifyMetadata);
        };
        CoveoInsightClient.prototype.getBaseCustomEventRequest = function (metadata) {
            return __awaiter(this, void 0, void 0, function () {
                var _a;
                return __generator(this, function (_b) {
                    switch (_b.label) {
                        case 0:
                            _a = [{}];
                            return [4, this.getBaseEventRequest(metadata)];
                        case 1: return [2, __assign.apply(void 0, [__assign.apply(void 0, _a.concat([(_b.sent())])), { lastSearchQueryUid: this.provider.getSearchUID() }])];
                    }
                });
            });
        };
        CoveoInsightClient.prototype.getBaseSearchEventRequest = function (event, metadata) {
            return __awaiter(this, void 0, void 0, function () {
                var _a;
                var _b, _c;
                return __generator(this, function (_d) {
                    switch (_d.label) {
                        case 0:
                            _a = [{}];
                            return [4, this.getBaseEventRequest(__assign(__assign({}, metadata), (_c = (_b = this.provider).getGeneratedAnswerMetadata) === null || _c === void 0 ? void 0 : _c.call(_b)))];
                        case 1: return [2, __assign.apply(void 0, [__assign.apply(void 0, [__assign.apply(void 0, _a.concat([(_d.sent())])), this.provider.getSearchEventRequestPayload()]), { searchQueryUid: this.provider.getSearchUID(), queryPipeline: this.provider.getPipeline(), actionCause: event }])];
                    }
                });
            });
        };
        CoveoInsightClient.prototype.getBaseEventRequest = function (metadata) {
            return __awaiter(this, void 0, void 0, function () {
                var customData, _a;
                var _b;
                return __generator(this, function (_c) {
                    switch (_c.label) {
                        case 0:
                            customData = __assign(__assign({}, this.provider.getBaseMetadata()), metadata);
                            _a = [__assign({}, this.getOrigins())];
                            _b = { customData: customData, language: this.provider.getLanguage(), facetState: this.provider.getFacetState ? this.provider.getFacetState() : [], anonymous: this.provider.getIsAnonymous() };
                            return [4, this.getClientId()];
                        case 1: return [2, __assign.apply(void 0, _a.concat([(_b.clientId = _c.sent(), _b)]))];
                    }
                });
            });
        };
        CoveoInsightClient.prototype.getOrigins = function () {
            var _a, _b;
            return {
                originContext: (_b = (_a = this.provider).getOriginContext) === null || _b === void 0 ? void 0 : _b.call(_a),
                originLevel1: this.provider.getOriginLevel1(),
                originLevel2: this.provider.getOriginLevel2(),
                originLevel3: this.provider.getOriginLevel3(),
            };
        };
        CoveoInsightClient.prototype.getClientId = function () {
            return this.coveoAnalyticsClient instanceof CoveoAnalyticsClient
                ? this.coveoAnalyticsClient.getCurrentVisitorId()
                : undefined;
        };
        return CoveoInsightClient;
    }());

    var analytics = /*#__PURE__*/Object.freeze({
        __proto__: null,
        get CaseAssistActions () { return CaseAssistActions; },
        CaseAssistClient: CaseAssistClient,
        get CaseAssistEvents () { return CaseAssistEvents; },
        get CaseCancelledReasons () { return CaseCancelledReasons; },
        CoveoAnalyticsClient: CoveoAnalyticsClient,
        CoveoInsightClient: CoveoInsightClient,
        CoveoSearchPageClient: CoveoSearchPageClient,
        CoveoUA: CoveoUA,
        CustomEventsTypes: CustomEventsTypes,
        get EventType () { return EventType; },
        get InsightEvents () { return InsightEvents; },
        get SearchPageEvents () { return SearchPageEvents; },
        SimpleAnalytics: simpleanalytics,
        analytics: analytics$1,
        donottrack: donottrack,
        getCurrentClient: getCurrentClient,
        handleOneAnalyticsEvent: handleOneAnalyticsEvent,
        history: history,
        storage: storage
    });

    var promise = window['Promise'];
    if (!(promise instanceof Function) && !global) {
        console.error("This script uses window.Promise which is not supported in your browser. Consider adding a polyfill like \"es6-promise\".");
    }
    var fetch$1 = window['fetch'];
    if (!(fetch$1 instanceof Function) && !global) {
        console.error("This script uses window.fetch which is not supported in your browser. Consider adding a polyfill like \"fetch\".");
    }
    var coveoua = self.coveoua || handleOneAnalyticsEvent;
    self.coveoua = handleOneAnalyticsEvent;
    self.coveoanalytics = analytics;
    if (coveoua.q) {
        var initEvents = coveoua.q.filter(function (args) { return args[0] === 'init'; });
        var otherEvents = coveoua.q.filter(function (args) { return args[0] !== 'init'; });
        __spreadArray(__spreadArray([], initEvents, true), otherEvents, true).forEach(function (args) { return handleOneAnalyticsEvent.apply(void 0, args); });
    }
    var browser = self.coveoua;

    return browser;

}));
//# sourceMappingURL=coveoua.debug.js.map
